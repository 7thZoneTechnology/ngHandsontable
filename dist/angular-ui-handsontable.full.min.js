/**
 * angular-ui-handsontable 0.2-beta3
 * 
 * Date: Mon Jan 07 2013 00:47:56 GMT+0100 (Central European Standard Time)
*/
document.all&&!document.addEventListener&&(document.createElement("ui-handsontable"),document.createElement("datacolumn"),document.createElement("optionlist")),angular.module("uiHandsontable",[]).directive("uiHandsontable",["$compile",function(e){var t={restrict:"EA",compile:function(n,r,i){var s={columns:[],colHeaders:!0,outsideClickDeselects:!1,autoComplete:[]},o=function(t,n,r){var i=n.optionList,s=i.match(/^\s*(.+)\s+in\s+(.*)\s*$/);if(!s)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+i+"'.");var o=s[1],u=s[2],a,f,l=t.$new(),c,h;n.source=function(e,i){if($.trim(e)===h)return;h=$.trim(e),a&&(a(),clearInterval(f));var s=r.$container.data("handsontable"),o=s.getSelected()[0];l[r.lhs]=t.$eval(r.rhs)[o],n.saveOnBlur||(l.$eval(n.value+' = "'+$.trim(e).replace(/"/g,'"')+'"'),l.$apply()),f=setInterval(function(){l.item=s.getData()[o],l.item?l.$apply():(a(),clearInterval(f))},100),a=l.$watch(u,function(e){c=e,i&&i(e)},!0)},n.sorter=function(e){return e},n.highlighter=function(t){var r,i=l.$new();return i[o]=t,n.linker?n.linker(i,function(e){r=e[0],r.style.display="block"}):r=e("<span>"+n.optionTemplate+"</span>")(i),r},n.select=function(){var e=r.$container.data("handsontable");if(this.$menu.find(".active").length){var t=this.$menu.find(".active").index();l[o]=c[t],e.destroyEditor(),l.$eval(n.clickrow)}else n.strict||(e.destroyEditor(),l.$eval(n.value+' = "'+$.trim(this.query).replace(/"/g,'"')+'"'));return $(".handsontable").each(function(){$(this).handsontable("render")}),h=void 0,this.hide()}},u=$('<div class="ui-handsontable-container"></div>'),a=r.datarows,f,l,c;a&&(f=a.match(/^\s*(.+)\s+in\s+(.*)\s*$/));if(!f)throw Error("Expected datarows in form of '_item_ in _collection_' but got '"+a+"'.");return l=f[1],c=f[2],n.data("uiDatagrid",{lhs:l,rhs:c,settings:angular.extend({},s),$container:u}),function(t,n,r,i){var s=n.data("uiDatagrid");s.settings=angular.extend(s.settings,t.$eval(r.uiHandsontable||r.settings)),$(n).append(u),typeof t[c]!="undefined"&&(s.settings.data=t[c]);var a=new RegExp("^("+l+"\\.)");for(var f=0,h=s.settings.columns.length;f<h;f++)s.settings.columns[f].data=s.settings.columns[f].value.replace(a,""),s.settings.columns[f].type==="autocomplete"&&o(t,s.settings.columns[f],s);u.handsontable(s.settings),u.on("datachange.handsontable",function(e,n,r){t.$$phase||t.$apply()}),u.on("selectionbyprop.handsontable",function(e,n,r,i,s){t.$emit("datagridSelection",u,n,r,i,s)}),t.$watch(function(){if(t[c]!==u.handsontable("getData"))return!0;var e="",n=u.data("handsontable"),r=n.countCols();for(var i=n.rowOffset(),s=i+n.countVisibleRows();i<s;i++)for(var o=0;o<r;o++)e+=n.getDataAtCell(i,o);return e},function(e,n){e==1?u.handsontable("loadData",t[c]):e!==n&&u.handsontable("render")},!1),t.$watch(function(){var e=t.$eval(r.uiHandsontable||r.settings);return e.columns},function(e,t){u.handsontable("updateSettings",{columns:s.settings.columns})},!0)}}};return t}]).directive("datacolumn",function(){var e={restrict:"E",priority:500,compile:function(t,n,r){var i=[];for(var s in n)n.hasOwnProperty(s)&&i.push(s);return t.data("uiDatagridColumn",{value:n.value,source:null,saveOnBlur:$.inArray("saveonblur",i)!==-1,strict:$.inArray("strict",i)!==-1}),function(t,n,r,i){var s,o=n.inheritedData("uiDatagrid"),u=t.$eval(r.title),a=t.$eval(r.width),f=t.$eval(r.type),l=r.options,c=t.$new(),h=t.$eval(l)||{};h.value=r.value,h.type=f,h.title=u,h.width=a;switch(f){case"autocomplete":var p=n.data("uiDatagridColumn");for(s in p)p.hasOwnProperty(s)&&(h[s]=p[s]);break;case"checkbox":typeof r.checkedtemplate!="undefined"&&(h.checkedTemplate=t.$eval(r.checkedtemplate)),typeof r.uncheckedtemplate!="undefined"&&(h.uncheckedTemplate=t.$eval(r.uncheckedtemplate))}typeof r.readonly!="undefined"&&(h.readOnly=!0);for(s in r)r.hasOwnProperty(s)&&s.charAt(0)!=="$"&&typeof h[s]=="undefined"&&(h[s]=c.$eval(r[s]));o.settings.columns.push(h)}}};return e}).directive("optionlist",function(){var e={restrict:"E",transclude:"element",priority:510,compile:function(t,n,r){return function(t,n,i,s){var o=n.inheritedData("uiDatagridColumn");o.optionList=i.datarows,o.clickrow=i.clickrow,o.linker=r}}};return e});var Handsontable={extension:{},helper:{}};(function(e,t,n){"use strict";function s(e){var t=e.data("typeahead");return t&&t.$menu.is(":visible")?t:!1}function o(e,t,r,i){n.helper.stringify(e.getDataAtCell(t,r))===n.helper.stringify(i.checkedTemplate)?e.setDataAtCell(t,r,i.uncheckedTemplate):e.setDataAtCell(t,r,i.checkedTemplate)}function u(){function a(e){var n=t.getSelected();switch(e){case"row_above":t.alter("insert_row",n[0]);break;case"row_below":t.alter("insert_row",n[2]+1);break;case"col_left":t.alter("insert_col",n[1]);break;case"col_right":t.alter("insert_col",n[3]+1);break;case"remove_row":t.alter(e,n[0],n[2]);break;case"remove_col":t.alter(e,n[1],n[3]);break;case"undo":t.undo();break;case"redo":t.redo()}}function f(e){return t.countRows()>=t.getSettings().maxRows&&(e==="row_above"||e==="row_below")?!0:t.countCols()>=t.getSettings().maxCols&&(e==="col_left"||e==="col_right")?!0:!1}var t=this,n={selector:"#"+t.rootElement.attr("id")+" table, #"+t.rootElement.attr("id")+" div",trigger:"right",callback:a},r={row_above:{name:"Insert row above",disabled:f},row_below:{name:"Insert row below",disabled:f},hsep1:"---------",col_left:{name:"Insert column on the left",disabled:f},col_right:{name:"Insert column on the right",disabled:f},hsep2:"---------",remove_row:{name:"Remove row",disabled:f},remove_col:{name:"Remove column",disabled:f},hsep3:"---------",undo:{name:"Undo",disabled:function(){return!t.isUndoAvailable()}},redo:{name:"Redo",disabled:function(){return!t.isRedoAvailable()}}},i={},s,o,u=t.getSettings();if(!u.contextMenu)return;if(u.contextMenu===!0)i.items=r;else if(Object.prototype.toString.apply(u.contextMenu)==="[object Array]"){i.items={};for(s=0,o=u.contextMenu.length;s<o;s++){var l=u.contextMenu[s];if(typeof r[l]=="undefined")throw new Error('Context menu key "'+l+'" is not recognised');i.items[l]=r[l]}}else if(Object.prototype.toString.apply(u.contextMenu)==="[object Object]"){i=u.contextMenu;if(i.items)for(s in i.items)i.items.hasOwnProperty(s)&&r[s]&&(typeof i.items[s]=="string"?i.items[s]=r[s]:i.items[s]=e.extend(!0,r[s],i.items[s]));else i.items=r;if(i.callback){var c=n.callback,h=i.callback;i.callback=function(e,t){c(e,t),h(e,t)}}}if(!t.rootElement.attr("id"))throw new Error("Handsontable container must have an id");e.contextMenu(e.extend(!0,n,i))}function a(e,t){this.instance=e,this.settings=t,this.wtDom=new l,this.main=document.createElement("div"),this.main.style.position="absolute",this.main.style.top=0,this.main.style.left=0;for(var n=0;n<5;n++){var r=document.createElement("DIV");r.className="wtBorder "+t.className,r.style.backgroundColor=t.border.color,r.style.height=t.border.width+"px",r.style.width=t.border.width+"px",this.main.appendChild(r)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.corner=this.main.childNodes[4],this.corner.className+=" corner",this.corner.style.width="5px",this.corner.style.height="5px",this.corner.style.border="2px solid #FFF",this.disappear(),e.wtTable.hider.appendChild(this.main)}function f(e){var t=this,n=[];this.defaults={table:void 0,async:!1,data:void 0,offsetRow:0,offsetColumn:0,frozenColumns:null,columnHeaders:!1,totalRows:void 0,totalColumns:void 0,width:null,height:null,displayRows:null,displayColumns:null,cellRenderer:function(e,n,r){var i=t.getSetting("data",e,n);i!==void 0?r.innerHTML=i:r.innerHTML=""},columnWidth:null,selections:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,scrollbarWidth:9,scrollbarHeight:9},this.settings={};for(var r in this.defaults)if(this.defaults.hasOwnProperty(r))if(e[r]!==void 0)this.settings[r]=e[r];else{if(this.defaults[r]===void 0)throw new Error('A required setting "'+r+'" was not provided');this.settings[r]=this.defaults[r]}this.wtTable=new v(this),this.wtScroll=new h(this),this.wtWheel=new m(this),this.wtEvent=new c(this),this.wtDom=new l;if(this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var i=0,s=this.wtTable.THEAD.childNodes[0].childNodes.length;i<s;i++)n.push(this.wtTable.THEAD.childNodes[0].childNodes[i].innerHTML);this.hasSetting("columnHeaders")||(this.settings.columnHeaders=function(e){return n[e]})}this.selections={};if(this.settings.selections)for(r in this.settings.selections)this.settings.selections.hasOwnProperty(r)&&(this.selections[r]=new d(this,this.settings.selections[r]));this.drawn=!1}function l(){}function c(t){var n=this;this.instance=t,this.wtDom=new l;var r=[null,null,null,null],i=null,s=function(e){var t=n.parentCell(e.target);t.TD&&t.TD.nodeName==="TD"?n.instance.settings.onCellMouseDown&&n.instance.getSetting("onCellMouseDown",e,t.coords,t.TD):n.wtDom.hasClass(e.target,"corner")&&n.instance.getSetting("onCellCornerMouseDown",e,e.target),e.button!==2&&(t.TD&&t.TD.nodeName==="TD"?(r.shift(),r.push(t.TD)):n.wtDom.hasClass(e.target,"corner")&&(r.shift(),r.push(e.target)))},o,u=function(e){if(n.instance.settings.onCellMouseOver){var t=n.wtDom.closest(e.target,["TD","TH"]);t&&t!==o&&(o=t,t.nodeName==="TD"&&n.instance.getSetting("onCellMouseOver",e,n.instance.wtTable.getCoords(t),t))}},a=function(e){if(e.button!==2){var t=n.parentCell(e.target);t.TD&&t.TD.nodeName==="TD"?(r.shift(),r.push(t.TD)):(r.shift(),r.push(e.target)),r[3]!==null&&r[3]===r[2]&&(i&&r[2]===r[1]&&r[1]===r[0]?(t.TD?n.instance.getSetting("onCellDblClick",e,t.coords,t.TD):n.wtDom.hasClass(e.target,"corner")&&n.instance.getSetting("onCellCornerDblClick",e,t.coords,t.TD),clearTimeout(i),i=null):(clearTimeout(i),i=setTimeout(function(){i=null},500)))}};e(this.instance.wtTable.parent).on("mousedown",s),e(this.instance.settings.table).on("mouseover",u),e(this.instance.wtTable.parent).on("mouseup",a)}function h(e){this.instance=e;if(e.hasSetting("height")||e.hasSetting("displayRows"))this.wtScrollbarV=new p(e,"vertical");if(e.hasSetting("width")||e.hasSetting("displayColumns"))this.wtScrollbarH=new p(e,"horizontal")}function p(t,n){var r=this;this.instance=t,this.type=n,this.$table=e(this.instance.wtTable.TABLE),this.slider=document.createElement("DIV"),this.slider.style.position="absolute",this.slider.style.top="0",this.slider.style.left="0",this.slider.className="dragdealer "+n,this.handle=document.createElement("DIV"),this.handle.className="handle",this.slider.appendChild(this.handle),this.instance.wtTable.parent.appendChild(this.slider),r.waitTimeout=null,r.queuedAnimationCallback=null,this.dragdealer=new b(this.slider,{vertical:n==="vertical",horizontal:n==="horizontal",speed:100,yPrecision:100,animationCallback:function(e,t){r.skipRefresh=!0;var i=function(){r.skipRefresh&&r.onScroll(n==="vertical"?t:e),r.waitTimeout=setTimeout(function(){r.waitTimeout=null,r.queuedAnimationCallback&&(r.queuedAnimationCallback(),r.queuedAnimationCallback=null)},100)};r.waitTimeout===null?i():r.queuedAnimationCallback=i},callback:function(e,t){r.skipRefresh=!1,r.onScroll(n==="vertical"?t:e)}}),r.skipRefresh=!1}function d(e,t){this.instance=e,this.settings=t,this.selected=[],t.border&&(this.border=new a(e,t)),this.onAdd=function(n){var r=e.wtTable.getCell(n);typeof r=="object"&&t.className&&e.wtDom.addClass(r,t.className)}}function v(t){this.instance=t,this.TABLE=this.instance.getSetting("table"),this.wtDom=new l,this.wtDom.removeTextNodes(this.TABLE),this.hasEmptyCellProblem=e.browser.msie&&parseInt(e.browser.version,10)<=7,this.hasCellSpacingProblem=e.browser.msie&&parseInt(e.browser.version,10)<=7,this.hasCellSpacingProblem&&(this.TABLE.cellSpacing=0),this.visibilityEdgeRow=this.visibilityEdgeColumn=null;var n=this.TABLE.parentNode;if(!n||n.nodeType!==1||!this.wtDom.hasClass(n,"wtHolder")){var r=document.createElement("DIV");this.instance.hasSetting("width")&&this.instance.hasSetting("height")&&(r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.width="4000px",r.style.height="4000px"),r.className="wtSpreader",n&&n.insertBefore(r,this.TABLE),r.appendChild(this.TABLE)}this.spreader=this.TABLE.parentNode,n=this.spreader.parentNode;if(!n||n.nodeType!==1||!this.wtDom.hasClass(n,"wtHolder")){var i=document.createElement("DIV");i.style.position="relative";if(this.instance.hasSetting("width")||this.instance.hasSetting("height"))i.style.overflow="hidden";this.instance.hasSetting("width")&&(i.style.width=this.instance.getSetting("width")-this.instance.getSetting("scrollbarWidth")+"px"),this.instance.hasSetting("height")&&(i.style.height=this.instance.getSetting("height")-this.instance.getSetting("scrollbarHeight")+"px"),i.className="wtHider",n&&n.insertBefore(i,this.spreader),i.appendChild(this.spreader)}this.hider=this.spreader.parentNode,n=this.hider.parentNode;if(!n||n.nodeType!==1||!this.wtDom.hasClass(n,"wtHolder")){var s=document.createElement("DIV");s.style.position="relative",s.className="wtHolder",n&&n.insertBefore(s,this.hider),s.appendChild(this.hider)}this.parent=this.hider.parentNode,this.TBODY=this.TABLE.getElementsByTagName("TBODY")[0],this.TBODY||(this.TBODY=document.createElement("TBODY"),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.getElementsByTagName("THEAD")[0],this.THEAD||(this.THEAD=document.createElement("THEAD"),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.getElementsByTagName("COLGROUP")[0],this.COLGROUP||(this.COLGROUP=document.createElement("COLGROUP"),this.TABLE.insertBefore(this.COLGROUP,this.THEAD));if(this.instance.hasSetting("columnHeaders")&&!this.THEAD.childNodes.length){var o=document.createElement("TR");this.THEAD.appendChild(o)}this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length}function m(t){var n=this;this.instance=t;var r;e(this.instance.settings.table).on("mousewheel",function(e,t,i,s){clearTimeout(r),r=setTimeout(function(){s?n.instance.scrollVertical(-Math.ceil(s)).draw():i&&n.instance.scrollHorizontal(Math.ceil(i)).draw()},0),e.preventDefault()})}n.Core=function(r,i){this.rootElement=r;var s,o,u,a,f,l,c,h=this;s={settings:{},selStart:new n.SelectionPoint,selEnd:new n.SelectionPoint,editProxy:!1,isPopulated:null,scrollable:null,undoRedo:null,extensions:{},colToProp:null,propToCol:null,dataSchema:null,dataType:"array",firstRun:!0},o={recursiveDuckSchema:function(t){var n;if(e.isPlainObject(t)){n={};for(var r in t)t.hasOwnProperty(r)&&(e.isPlainObject(t[r])?n[r]=o.recursiveDuckSchema(t[r]):n[r]=null)}else n=[];return n},recursiveDuckColumns:function(t,n,r){var i,u;typeof n=="undefined"&&(n=0,r="");if(e.isPlainObject(t))for(u in t)t.hasOwnProperty(u)&&(t[u]===null?(i=r+u,s.colToProp.push(i),s.propToCol[i]=n,n++):n=o.recursiveDuckColumns(t[u],n,u+"."));return n},createMap:function(){if(typeof o.getSchema()=="undefined")throw new Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");var e,t,n=o.getSchema();s.colToProp=[],s.propToCol={};if(s.settings.columns)for(e=0,t=s.settings.columns.length;e<t;e++)s.colToProp[e]=s.settings.columns[e].data,s.propToCol[s.settings.columns[e].data]=e;else o.recursiveDuckColumns(n)},colToProp:function(e){return s.colToProp&&typeof s.colToProp[e]!="undefined"?s.colToProp[e]:e},propToCol:function(e){return typeof s.propToCol[e]!="undefined"?s.propToCol[e]:e},getSchema:function(){return s.settings.dataSchema?typeof s.settings.dataSchema=="function"?s.settings.dataSchema():s.settings.dataSchema:s.duckDataSchema},createRow:function(t){var n;if(s.dataType==="array"){n=[];for(var r=0,i=h.countCols();r<i;r++)n.push(null)}else n=e.extend(!0,{},o.getSchema());!t||t.row>=h.countRows()?(s.settings.onCreateRow&&s.settings.onCreateRow(h.countRows(),n),s.settings.data.push(n)):(s.settings.onCreateRow&&s.settings.onCreateRow(t.row,n),s.settings.data.splice(t.row,0,n)),h.forceFullRender=!0},createCol:function(e){if(s.dataType==="object"||s.settings.columns)throw new Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting");var t=0,n=h.countRows();if(!e||e.col>=h.countCols())for(;t<n;t++)typeof s.settings.data[t]=="undefined"&&(s.settings.data[t]=[]),s.settings.data[t].push("");else for(;t<n;t++)s.settings.data[t].splice(e.col,0,"");h.forceFullRender=!0},removeRow:function(e,t){!e||e.row===h.countRows()-1?s.settings.data.pop():s.settings.data.splice(e.row,t.row-e.row+1),h.forceFullRender=!0},removeCol:function(e,t){if(s.dataType==="object"||s.settings.columns)throw new Error("cannot remove column with object data source or columns option specified");var n=0;if(!e||e.col===h.countCols()-1)for(;n<h.countRows();n++)s.settings.data[n].pop();else{var r=t.col-e.col+1;for(;n<h.countRows();n++)s.settings.data[n].splice(e.col,r)}h.forceFullRender=!0},get:function(e,t){if(typeof t=="string"&&t.indexOf(".")>-1){var n=t.split("."),r=s.settings.data[e];if(!r)return null;for(var i=0,o=n.length;i<o;i++){r=r[n[i]];if(typeof r=="undefined")return null}return r}return s.settings.data[e]?s.settings.data[e][t]:null},set:function(e,t,n){if(typeof t=="string"&&t.indexOf(".")>-1){var r=t.split("."),i=s.settings.data[e];for(var o=0,u=r.length-1;o<u;o++)i=i[r[o]];i[r[o]]=n}else s.settings.data[e][t]=n},clear:function(){for(var e=0;e<h.countRows();e++)for(var t=0;t<h.countCols();t++)o.set(e,o.colToProp(t),"")},getAll:function(){return s.settings.data},getRange:function(e,t){var n,r,i,s,u=[],a;r=Math.max(e.row,t.row),s=Math.max(e.col,t.col);for(n=Math.min(e.row,t.row);n<=r;n++){a=[];for(i=Math.min(e.col,t.col);i<=s;i++)a.push(o.get(n,o.colToProp(i)));u.push(a)}return u},getText:function(e,t){return SheetClip.stringify(o.getRange(e,t))}},u={alter:function(t,n,r){var i,f,l,c,d,v,m;i=e.extend(!0,[],o.getAll());switch(t){case"insert_row":h.countRows()<s.settings.maxRows&&(o.createRow(n),s.selStart.exists()&&s.selStart.row()>=n.row?(s.selStart.row(s.selStart.row()+1),a.transformEnd(1,0)):a.refreshBorders());break;case"insert_col":h.countCols()<s.settings.maxCols&&(o.createCol(n),s.selStart.exists()&&s.selStart.col()>=n.col?(s.selStart.col(s.selStart.col()+1),a.transformEnd(0,1)):a.refreshBorders());break;case"remove_row":o.removeRow(n,r),u.keepEmptyRows(),a.refreshBorders();break;case"remove_col":o.removeCol(n,r),u.keepEmptyRows(),a.refreshBorders()}l=[],f=o.getAll();for(c=0,d=f.length;c<d;c++)for(v=0,m=f[c].length;v<m;v++)l.push([c,v,i[c]?i[c][v]:null,f[c][v]]);p("datachange.handsontable",[l,"alter"]),u.keepEmptyRows()},keepEmptyRows:function(){var e,t,n,r,i=0,u=0,f;e:for(e=h.countRows()-1;e>=0;e--){for(t=0,r=h.countCols();t<r;t++){f=o.get(e,o.colToProp(t));if(f!==""&&f!==null&&typeof f!="undefined")break e}i++}n=h.countRows();if(n<s.settings.minRows)for(e=0;e<s.settings.minRows-n;e++)o.createRow();if(i<s.settings.minSpareRows)for(;i<s.settings.minSpareRows&&h.countRows()<s.settings.maxRows;i++)o.createRow();if(h.countRows()-1>0)t:for(t=h.countCols()-1;t>=0;t--){for(e=0;e<h.countRows();e++){f=o.get(e,o.colToProp(t));if(f!==""&&f!==null&&typeof f!="undefined")break t}u++}if(!s.settings.columns&&h.countCols()<s.settings.minCols)for(;h.countCols()<s.settings.minCols;u++)o.createCol();if(!s.settings.columns&&s.dataType==="array"&&u<s.settings.minSpareCols)for(;u<s.settings.minSpareCols&&h.countCols()<s.settings.maxCols;u++)o.createCol();if(s.settings.enterBeginsEditing)for(;(s.settings.minRows||s.settings.minSpareRows)&&h.countRows()>s.settings.minRows&&s.settings.minSpareRows&&i>s.settings.minSpareRows;i--)o.removeRow();if(s.settings.enterBeginsEditing&&!s.settings.columns)for(;(s.settings.minCols||s.settings.minSpareCols)&&h.countCols()>s.settings.minCols&&s.settings.minSpareCols&&u>s.settings.minSpareCols;u--)o.removeCol();var l=h.countRows(),c=h.countCols();(l===0||c===0)&&a.deselect();if(s.selStart.exists()){var p,d=s.selStart.row(),v=s.selStart.col(),m=s.selEnd.row(),g=s.selEnd.col();d>l-1?(d=l-1,p=!0,m>d&&(m=d)):m>l-1&&(m=l-1,p=!0,d>m&&(d=m)),v>c-1?(v=c-1,p=!0,g>v&&(g=v)):g>c-1&&(g=c-1,p=!0,v>g&&(v=g)),p&&h.selectCell(d,v,m,g)}},populateFromArray:function(e,t,n,r){var i,u,a,f,l=[],c={};u=t.length;if(u===0)return!1;c.row=e.row,c.col=e.col;for(i=0;i<u;i++){if(n&&c.row>n.row||!s.settings.minSpareRows&&c.row>h.countRows()-1||c.row>=s.settings.maxRows)break;c.col=e.col,f=t[i]?t[i].length:0;for(a=0;a<f;a++){if(n&&c.col>n.col||!s.settings.minSpareCols&&c.col>h.countCols()-1||c.col>=s.settings.maxCols)break;if(h.getCellMeta(c.row,c.col).isWritable){var p=o.colToProp(c.col);l.push([c.row,p,t[i][a]])}c.col++,n&&a===f-1&&(a=-1)}c.row++,n&&i===u-1&&(i=-1)}h.setDataAtCell(l,null,null,r||"populateFromArray")},getCornerCoords:function(t){function n(t,n,r){function i(e){return e[r]}return Array.prototype.map?t.apply(Math,n.map(i)):t.apply(Math,e.map(n,i))}return{TL:{row:n(Math.min,t,"row"),col:n(Math.min,t,"col")},BR:{row:n(Math.max,t,"row"),col:n(Math.max,t,"col")}}},getCellsAtCoords:function(e,t){var n=u.getCornerCoords([e,t]),r,i,s=[];for(r=n.TL.row;r<=n.BR.row;r++)for(i=n.TL.col;i<=n.BR.col;i++)s.push(h.view.getCellAtCoords({row:r,col:i}));return s}},this.selection=a={setRangeStart:function(e){a.deselect(),s.selStart.coords(e),a.setRangeEnd(e)},setRangeEnd:function(e,t){s.selEnd.coords(e),s.settings.multiSelect||s.selStart.coords(e),h.view.wt.selections.current.clear(),h.view.wt.selections.current.add(s.selStart.arr()),h.view.wt.selections.area.clear(),a.isMultiple()&&(h.view.wt.selections.area.add(s.selStart.arr()),h.view.wt.selections.area.add(s.selEnd.arr())),h.rootElement.triggerHandler("selection.handsontable",[s.selStart.row(),s.selStart.col(),s.selEnd.row(),s.selEnd.col()]),h.rootElement.triggerHandler("selectionbyprop.handsontable",[s.selStart.row(),o.colToProp(s.selStart.col()),s.selEnd.row(),o.colToProp(s.selEnd.col())]),t!==!1&&(h.view.scrollViewport(e),h.view.wt.draw(!0),h.view.scrollViewport(e)),a.refreshBorders()},refreshBorders:function(e,t){t||f.destroy(e),h.view.render(),a.isSelected()&&!t&&f.prepare()},isMultiple:function(){return s.selEnd.col()!==s.selStart.col()||s.selEnd.row()!==s.selStart.row()},transformStart:function(e,t,n){s.selStart.row()+e>h.countRows()-1?n&&s.settings.minSpareRows>0?h.alter("insert_row",h.countRows()):s.settings.autoWrapCol&&s.selStart.col()+t<h.countCols()-1&&(e=1-h.countRows(),t=1):s.settings.autoWrapCol&&s.selStart.row()+e<0&&s.selStart.col()+t>=0&&(e=h.countRows()-1,t=-1),s.selStart.col()+t>h.countCols()-1?n&&s.settings.minSpareCols>0?h.alter("insert_col",h.countCols()):s.settings.autoWrapRow&&s.selStart.row()+e<h.countRows()-1&&(e=1,t=1-h.countCols()):s.settings.autoWrapRow&&s.selStart.col()+t<0&&s.selStart.row()+e>=0&&(e=-1,t=h.countCols()-1);var r=h.countRows(),i=h.countCols(),o={row:s.selStart.row()+e,col:s.selStart.col()+t};o.row<0?o.row=0:o.row>0&&o.row>=r&&(o.row=r-1),o.col<0?o.col=0:o.col>0&&o.col>=i&&(o.col=i-1),a.setRangeStart(o)},transformEnd:function(e,t){if(s.selEnd.exists()){var n=h.countRows(),r=h.countCols(),i={row:s.selEnd.row()+e,col:s.selEnd.col()+t};i.row<0?i.row=0:i.row>0&&i.row>=n&&(i.row=n-1),i.col<0?i.col=0:i.col>0&&i.col>=r&&(i.col=r-1),a.setRangeEnd(i)}},isSelected:function(){return s.selEnd.exists()},inInSelection:function(e){if(!a.isSelected())return!1;var t=u.getCornerCoords([s.selStart.coords(),s.selEnd.coords()]);return t.TL.row<=e.row&&t.BR.row>=e.row&&t.TL.col<=e.col&&t.BR.col>=e.col},deselect:function(){if(!a.isSelected())return;s.selEnd=new n.SelectionPoint,f.destroy(),h.rootElement.triggerHandler("deselect.handsontable")},selectAll:function(){if(!s.settings.multiSelect)return;a.setRangeStart({row:0,col:0}),a.setRangeEnd({row:h.countRows()-1,col:h.countCols()-1},!1)},empty:function(){if(!a.isSelected())return;var e=u.getCornerCoords([s.selStart.coords(),s.selEnd.coords()]),t,n,r=[];for(t=e.TL.row;t<=e.BR.row;t++)for(n=e.TL.col;n<=e.BR.col;n++)h.getCellMeta(t,n).isWritable&&r.push([t,o.colToProp(n),""]);h.setDataAtCell(r)}},this.autofill=l={handle:null,init:function(){l.handle?l.handle.disabled=!1:l.handle={}},disable:function(){l.handle.disabled=!0},selectAdjacent:function(){var e,t,n,r,i;a.isMultiple()?e=h.view.wt.selections.area.getCorners():e=h.view.wt.selections.current.getCorners(),t=o.getAll();e:for(n=e[2]+1;n<h.countRows();n++){for(i=e[1];i<=e[3];i++)if(t[n][i])break e;if(!!t[n][e[1]-1]||!!t[n][e[3]+1])r=n}r&&(h.view.wt.selections.fill.clear(),h.view.wt.selections.fill.add([e[0],e[1]]),h.view.wt.selections.fill.add([r,e[3]]),l.apply())},apply:function(){var e,t,n,r;l.handle.isDragged=0,e=h.view.wt.selections.fill.getCorners();if(!e)return;h.view.wt.selections.fill.clear(),a.isMultiple()?t=h.view.wt.selections.area.getCorners():t=h.view.wt.selections.current.getCorners(),e[0]===t[0]&&e[1]<t[1]?(n={row:e[0],col:e[1]},r={row:e[2],col:t[1]-1}):e[0]===t[0]&&e[3]>t[3]?(n={row:e[0],col:t[3]+1},r={row:e[2],col:e[3]}):e[0]<t[0]&&e[1]===t[1]?(n={row:e[0],col:e[1]},r={row:t[0]-1,col:e[3]}):e[2]>t[2]&&e[1]===t[1]&&(n={row:t[2]+1,col:e[1]},r={row:e[2],col:e[3]}),n&&(u.populateFromArray(n,SheetClip.parse(o.getText(s.selStart.coords(),s.selEnd.coords())),r,"autofill"),a.setRangeStart({row:e[0],col:e[1]}),a.setRangeEnd({row:e[2],col:e[3]}))},showBorder:function(e){e.row=e[0],e.col=e[1];var t=u.getCornerCoords([s.selStart.coords(),s.selEnd.coords()]);if(s.settings.fillHandle!=="horizontal"&&(t.BR.row<e.row||t.TL.row>e.row))e=[e.row,t.BR.col];else{if(s.settings.fillHandle==="vertical")return;e=[t.BR.row,e.col]}h.view.wt.selections.fill.clear(),h.view.wt.selections.fill.add([s.selStart.coords().row,s.selStart.coords().col]),h.view.wt.selections.fill.add([s.selEnd.coords().row,s.selEnd.coords().col]),h.view.wt.selections.fill.add(e),h.view.render()}},f={init:function(){function t(e){e.stopPropagation()}function r(){setTimeout(function(){a.empty()},100)}function i(){setTimeout(function(){h.rootElement.one("datachange.handsontable",function(e,t,n){if(t.length){var r=t[t.length-1];a.setRangeEnd({row:r[0],col:h.propToCol(r[1])})}});var e=s.editProxy[0].value.replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),t=SheetClip.parse(e),n=u.getCornerCoords([s.selStart.coords(),s.selEnd.coords()]);u.populateFromArray(n.TL,t,{row:Math.max(n.BR.row,t.length-1+n.TL.row),col:Math.max(n.BR.col,t[0].length-1+n.TL.col)},"paste")},100)}function l(t){if(o.children(".context-menu-list:visible").length)return;if(t.keyCode===17||t.keyCode===224||t.keyCode===91||t.keyCode===93){f.setCopyableText();return}s.lastKeyCode=t.keyCode;if(a.isSelected()){var r=(t.ctrlKey||t.metaKey)&&!t.altKey;if(n.helper.isPrintableChar(t.keyCode)&&r){t.keyCode===65?(a.selectAll(),f.setCopyableText()):t.keyCode===88&&e.browser.opera?s.editProxyHolder.triggerHandler("cut"):t.keyCode===86&&e.browser.opera?s.editProxyHolder.triggerHandler("paste"):t.keyCode===89||t.shiftKey&&t.keyCode===90?s.undoRedo&&s.undoRedo.redo():t.keyCode===90&&s.undoRedo&&s.undoRedo.undo();return}var i=t.shiftKey?a.setRangeEnd:a.setRangeStart;switch(t.keyCode){case 38:t.shiftKey?a.transformEnd(-1,0):a.transformStart(-1,0),t.preventDefault();break;case 9:var u=typeof s.settings.tabMoves=="function"?s.settings.tabMoves(t):s.settings.tabMoves;t.shiftKey?a.transformStart(-u.row,-u.col):a.transformStart(u.row,u.col,!0),t.preventDefault();break;case 39:t.shiftKey?a.transformEnd(0,1):a.transformStart(0,1),t.preventDefault();break;case 37:t.shiftKey?a.transformEnd(0,-1):a.transformStart(0,-1),t.preventDefault();break;case 8:case 46:a.empty(t),t.preventDefault();break;case 40:t.shiftKey?a.transformEnd(1,0):a.transformStart(1,0),t.preventDefault();break;case 113:t.preventDefault();break;case 13:var l=typeof s.settings.enterMoves=="function"?s.settings.enterMoves(t):s.settings.enterMoves;t.shiftKey?a.transformStart(-l.row,-l.col):a.transformStart(l.row,l.col,!0),t.preventDefault();break;case 36:t.ctrlKey||t.metaKey?i({row:0,col:s.selStart.col()}):i({row:s.selStart.row(),col:0});break;case 35:t.ctrlKey||t.metaKey?i({row:h.countRows()-1,col:s.selStart.col()}):i({row:s.selStart.row(),col:h.countCols()-1});break;case 33:a.transformStart(-h.countVisibleRows(),0),h.view.wt.scrollVertical(-h.countVisibleRows()),h.view.render(),t.preventDefault();break;case 34:a.transformStart(h.countVisibleRows(),0),h.view.wt.scrollVertical(h.countVisibleRows()),h.view.render(),t.preventDefault();break;default:}}}s.editProxy=e('<textarea class="handsontableInput">'),s.editProxyHolder=e('<div class="handsontableInputHolder">'),s.editProxyHolder.append(s.editProxy);var o=e(document.body);s.editProxy.on("click",t),s.editProxyHolder.on("cut",r),s.editProxyHolder.on("paste",i),s.editProxyHolder.on("keydown",l),h.rootElement.append(s.editProxyHolder)},destroy:function(e){typeof s.editorDestroyer=="function"&&(s.editorDestroyer(e),s.editorDestroyer=null)},setCopyableText:function(){var e=Math.min(s.selStart.row(),s.selEnd.row()),t=Math.min(s.selStart.col(),s.selEnd.col()),n=Math.max(s.selStart.row(),s.selEnd.row()),r=Math.max(s.selStart.col(),s.selEnd.col()),i=Math.min(n,e+s.settings.copyRowsLimit-1),u=Math.min(r,t+s.settings.copyColsLimit-1);s.editProxy[0].value=o.getText({row:e,col:t},{row:i,col:u}),setTimeout(f.focus,1),(n!==i||r!==u)&&s.settings.onCopyLimit&&s.settings.onCopyLimit(n-e+1,r-t+1,s.settings.copyRowsLimit,s.settings.copyColsLimit)},prepare:function(){s.editProxy.height(s.editProxy.parent().innerHeight()-4),s.editProxy[0].value="",setTimeout(f.focus,1),s.settings.asyncRendering?(clearTimeout(t.prepareFrame),t.prepareFrame=setTimeout(function(){s.editorDestroyer=h.view.applyCellTypeMethod("editor",h.view.getCellAtCoords(s.selStart.coords()),s.selStart.coords(),s.editProxy)},0)):s.editorDestroyer=h.view.applyCellTypeMethod("editor",h.view.getCellAtCoords(s.selStart.coords()),s.selStart.coords(),s.editProxy)},focus:function(){try{s.editProxy[0].select()}catch(e){}}},this.init=function(){f.init(),d(),this.updateSettings(i),this.view=new n.TableView(this),typeof s.firstRun=="object"&&(p("datachange.handsontable",s.firstRun),s.firstRun=!1),n.PluginHooks.run(h,"afterInit")},c=function(t,n){var r=e.Deferred(),i=[];if(n==="paste"){var o=function(n){var r=e.Deferred();i.push(r);var s=t[n][3],o=typeof s=="string"?s.toLowerCase():null;return function(e){var i=!1;for(var u=0,a=e.length;u<a;u++){if(s===e[u]){i=!0;break}if(o===e[u].toLowerCase()){t[n][3]=e[u],i=!0;break}}i||(t[n]=null),r.resolve()}};for(var u=t.length-1;u>=0;u--){var a=h.getCellMeta(t[u][0],t[u][1]);if(a.strict&&a.source){var f=e.isFunction(a.source)?a.source(t[u][3],o(u)):a.source;f&&o(u)(f)}}}return e.when(i).then(function(){for(var i=t.length-1;i>=0;i--)t[i]===null&&t.splice(i,1);if(s.settings.onBeforeChange&&t.length){var o=s.settings.onBeforeChange.apply(h.rootElement[0],[t,n]);typeof o=="function"?e.when(o).then(function(){r.resolve()}):(o===!1&&t.splice(0,t.length),r.resolve())}else r.resolve()}),e.when(r)};var p=function(e,t){s.settings.asyncRendering?setTimeout(function(){h.rootElement.triggerHandler(e,t)},0):h.rootElement.triggerHandler(e,t)},d=function(){h.rootElement.on("datachange.handsontable",function(e,t,n){s.settings.onChange&&s.settings.onChange.apply(h.rootElement[0],[t,n])}),h.rootElement.on("selection.handsontable",function(e,t,n,r,i){s.settings.onSelection&&s.settings.onSelection.apply(h.rootElement[0],[t,n,r,i])}),h.rootElement.on("selectionbyprop.handsontable",function(e,t,n,r,i){s.settings.onSelectionByProp&&s.settings.onSelectionByProp.apply(h.rootElement[0],[t,n,r,i])})};this.setDataAtCell=function(t,n,r,i){var f,l,d;typeof t=="object"?f=t:e.isPlainObject(r)?f=r:f=[[t,n,r]];for(l=0,d=f.length;l<d;l++)f[l].splice(2,0,o.get(f[l][0],f[l][1]));c(f,i).then(function(){for(l=0,d=f.length;l<d;l++){t=f[l][0],n=f[l][1];var e=o.propToCol(n);r=f[l][3];if(s.settings.minSpareRows)while(t>h.countRows()-1)o.createRow();if(s.dataType==="array"&&s.settings.minSpareCols)while(e>h.countCols()-1)o.createCol();o.set(t,n,r)}h.forceFullRender=!0,u.keepEmptyRows(),a.refreshBorders(),p("datachange.handsontable",[f,i||"edit"])})},this.destroyEditor=function(e){a.refreshBorders(e)},this.populateFromArray=function(e,t,n,r){return u.populateFromArray(e,t,n,r)},this.getCornerCoords=function(e){return u.getCornerCoords(e)},this.getSelected=function(){if(a.isSelected()){var e=u.getCornerCoords([s.selStart.coords(),s.selEnd.coords()]);return[e.TL.row,e.TL.col,e.BR.row,e.BR.col]}},this.render=function(){h.view&&(h.forceFullRender=!0,a.refreshBorders(null,!0),s.editProxy.triggerHandler("refreshBorder"))},this.loadData=function(t,n){var r,i,a,f,l,c;s.isPopulated=!1,s.settings.data=t,e.isPlainObject(s.settings.dataSchema)||e.isPlainObject(t[0])?s.dataType="object":s.dataType="array",t[0]?s.duckDataSchema=o.recursiveDuckSchema(t[0]):s.duckDataSchema={},o.createMap();if(n){a=h.countRows();if(s.settings.startRows)while(s.settings.startRows>a)o.createRow(),a++}u.keepEmptyRows(),r=[],a=h.countRows(),l=h.countCols();for(i=0;i<a;i++)for(f=0;f<l;f++)c=o.colToProp(f),r.push([i,c,"",o.get(i,c)]);s.firstRun?s.firstRun=[r,"loadData"]:(p("datachange.handsontable",[r,"loadData"]),h.render()),s.isPopulated=!0,h.clearUndo()},this.getData=function(e,t,n,r){return typeof e=="undefined"?o.getAll():o.getRange({row:e,col:t},{row:n,col:r})},this.updateSettings=function(e){var t;if(typeof e.rows!="undefined")throw new Error("'rows' setting is no longer supported. do you mean startRows, minRows or maxRows?");if(typeof e.cols!="undefined")throw new Error("'cols' setting is no longer supported. do you mean startCols, minCols or maxCols?");typeof e.undo!="undefined"&&(s.undoRedo&&e.undo===!1?s.undoRedo=null:!s.undoRedo&&e.undo===!0&&(s.undoRedo=new n.UndoRedo(h)));for(t in e){if(t==="data")continue;e.hasOwnProperty(t)&&(s.settings[t]=e[t],n.extension[t]&&(s.extensions[t]=new n.extension[t](h,e[t])))}if(s.settings.data===void 0&&e.data===void 0){e.data=[];var r;for(var i=0,f=s.settings.startRows;i<f;i++){r=[];for(var c=0,p=s.settings.startCols;c<p;c++)r.push(null);e.data.push(r)}}e.data!==void 0?h.loadData(e.data,!0):e.columns!==void 0&&o.createMap(),typeof e.fillHandle!="undefined"&&(l.handle&&e.fillHandle===!1?l.disable():!l.handle&&e.fillHandle!==!1&&l.init()),u.keepEmptyRows(),h.view&&(h.forceFullRender=!0,a.refreshBorders(null,!0))},this.getSettings=function(){return s.settings},this.clear=function(){a.selectAll(),a.empty()},this.isUndoAvailable=function(){return s.undoRedo&&s.undoRedo.isUndoAvailable()},this.isRedoAvailable=function(){return s.undoRedo&&s.undoRedo.isRedoAvailable()},this.undo=function(){s.undoRedo&&s.undoRedo.undo()},this.redo=function(){s.undoRedo&&s.undoRedo.redo()},this.clearUndo=function(){s.undoRedo&&s.undoRedo.clear()},this.alter=function(e,t,n){typeof n=="undefined"&&(n=t);switch(e){case"insert_row":case"remove_row":u.alter(e,{row:t,col:0},{row:n,col:0});break;case"insert_col":case"remove_col":u.alter(e,{row:0,col:t},{row:0,col:n});break;default:throw Error('There is no such action "'+e+'"')}},this.getCell=function(e,t){return h.view.getCellAtCoords({row:e,col:t})},this.colToProp=function(e){return o.colToProp(e)},this.propToCol=function(e){return o.propToCol(e)},this.getDataAtCell=function(e,t){return o.get(e,o.colToProp(t))},this.getCellMeta=function(t,r){var i={},u=o.colToProp(r);return s.settings.columns&&(i=e.extend(!0,i,s.settings.columns[r]||{})),s.settings.cells&&(i=e.extend(!0,i,s.settings.cells(t,r,u)||{})),i.isWritable=!i.readOnly,n.PluginHooks.run(h,"afterGetCellMeta",[t,r,i]),i},this.getRowHeader=function(e){return Object.prototype.toString.call(s.settings.rowHeaders)==="[object Array]"&&s.settings.rowHeaders[e]!==void 0?s.settings.rowHeaders[e]:typeof s.settings.rowHeaders=="function"?s.settings.rowHeaders(e):s.settings.rowHeaders&&typeof s.settings.rowHeaders!="string"&&typeof s.settings.rowHeaders!="number"?e+1:s.settings.rowHeaders},this.getColHeader=function(e){if(s.settings.columns&&s.settings.columns[e]&&s.settings.columns[e].title)return s.settings.columns[e].title;if(Object.prototype.toString.call(s.settings.colHeaders)==="[object Array]"&&s.settings.colHeaders[e]!==void 0)return s.settings.colHeaders[e];if(typeof s.settings.colHeaders=="function")return s.settings.colHeaders(e);if(s.settings.colHeaders&&typeof s.settings.colHeaders!="string"&&typeof s.settings.colHeaders!="number"){var t=e+1,n="",r;while(t>0)r=(t-1)%26,n=String.fromCharCode(65+r)+n,t=parseInt((t-r)/26);return n}return s.settings.colHeaders},this.getColWidth=function(e){if(s.settings.columns&&s.settings.columns[e]&&s.settings.columns[e].width)return s.settings.columns[e].width;if(Object.prototype.toString.call(s.settings.colWidths)==="[object Array]"&&s.settings.colWidths[e]!==void 0)return s.settings.colWidths[e]},this.countRows=function(){return s.settings.data.length},this.countCols=function(){if(s.dataType==="object")return s.settings.columns&&s.settings.columns.length?s.settings.columns.length:s.colToProp.length;if(s.dataType==="array")return s.settings.columns&&s.settings.columns.length?s.settings.columns.length:Math.max(s.settings.columns&&s.settings.columns.length||0,s.settings.data&&s.settings.data[0]&&s.settings.data[0].length||0)},this.rowOffset=function(){return h.view.wt.getSetting("offsetRow")},this.colOffset=function(){return h.view.wt.getSetting("offsetColumn")},this.countVisibleRows=function(){return h.view.wt.getSetting("viewportRows")},this.countVisibleCols=function(){return h.view.wt.getSetting("viewportColumns")},this.selectCell=function(e,t,n,r,i){if(typeof e!="number"||e<0||e>=h.countRows())return!1;if(typeof t!="number"||t<0||t>=h.countCols())return!1;if(typeof n!="undefined"){if(typeof n!="number"||n<0||n>=h.countRows())return!1;if(typeof r!="number"||r<0||r>=h.countCols())return!1}s.selStart.coords({row:e,col:t}),typeof n=="undefined"?a.setRangeEnd({row:e,col:t},i):a.setRangeEnd({row:n,col:r},i)},this.selectCellByProp=function(e,t,n,r,i){return arguments[1]=o.propToCol(arguments[1]),typeof arguments[3]!="undefined"&&(arguments[3]=o.propToCol(arguments[3])),h.selectCell.apply(h,arguments)},this.deselectCell=function(){a.deselect()},this.destroy=function(){h.rootElement.empty(),h.rootElement.removeData("handsontable"),h.rootElement.off(".handsontable")},this.version="0.8.2"};var r={data:void 0,startRows:5,startCols:5,minRows:0,minCols:0,maxRows:Infinity,maxCols:Infinity,minSpareRows:0,minSpareCols:0,multiSelect:!0,fillHandle:!0,undo:!0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,asyncRendering:!0};e.fn.handsontable=function(t){var i,s,o,u=[],a;if(typeof t!="string")return a=t||{},this.each(function(){var t=e(this);if(t.data("handsontable"))o=t.data("handsontable"),o.updateSettings(a);else{var s=e.extend(!0,{},r),o;for(i in a)a.hasOwnProperty(i)&&(s[i]=a[i]);o=new n.Core(t,s),t.data("handsontable",o),o.init()}});o=[];if(arguments.length>1)for(i=1,s=arguments.length;i<s;i++)o.push(arguments[i]);return this.each(function(){u=e(this).data("handsontable")[t].apply(this,o)}),u},n.TableView=function(t){var r=this;this.instance=t;var s=this.instance.getSettings();t.rootElement.addClass("handsontable");var o=e('<table class="htCore"><thead></thead><tbody></tbody></table>');t.rootElement.prepend(o);var u=t.rootElement[0].style.overflow,a=s.width,l=s.height;(a||l)&&u!=="scroll"&&u!=="auto"&&(u="auto");if(u==="scroll"||u==="auto")t.rootElement[0].style.overflow="visible",s.width===void 0&&parseInt(t.rootElement[0].style.width)>0&&(a=parseInt(t.rootElement[0].style.width),t.rootElement[0].style.width=""),s.height===void 0&&parseInt(t.rootElement[0].style.height)>0&&(l=parseInt(t.rootElement[0].style.height),t.rootElement[0].style.height="");var c,h;e(document.body).on("mouseup",function(){c=!1,clearInterval(h),h=null,t.autofill.handle&&t.autofill.handle.isDragged&&(t.autofill.handle.isDragged>1&&t.autofill.apply(),t.autofill.handle.isDragged=0)}),o.on("selectstart",function(e){e.preventDefault()}),o.on("mouseenter",function(){h&&(clearInterval(h),h=null)}),o.on("mouseleave",function(e){if(!(c||t.autofill.handle&&t.autofill.handle.isDragged))return;var n=1,i=r.wt.wtDom.offset(o[0]),s=i.top+n,u=i.left+n,f=a-r.wt.settings.scrollbarWidth-2*n,p=l-r.wt.settings.scrollbarHeight-2*n,d,v=0,m=0,g;e.pageY<s?(v=-1,d="scrollVertical"):e.pageY>=s+p?(v=1,d="scrollVertical"):e.pageX<u?(m=-1,d="scrollHorizontal"):e.pageX>=u+f&&(m=1,d="scrollHorizontal"),d&&(g=function(){(c||t.autofill.handle&&t.autofill.handle.isDragged)&&r.wt[d](v+m).draw()},g(),h=setInterval(g,100))});var p={table:o[0],async:s.asyncRendering,data:t.getDataAtCell,totalRows:t.countRows,totalColumns:t.countCols,offsetRow:0,offsetColumn:0,displayRows:null,displayColumns:null,width:a,height:l,frozenColumns:s.rowHeaders?[t.getRowHeader]:null,columnHeaders:s.colHeaders?t.getColHeader:null,columnWidth:t.getColWidth,cellRenderer:function(e,n,i){r.applyCellTypeMethod("renderer",i,{row:e,col:n},t.getDataAtCell(e,n))},selections:{current:{className:"current",border:{width:2,color:"#5292F7",style:"solid",cornerVisible:function(){return s.fillHandle&&!i.isCellEdited&&!t.selection.isMultiple()}}},area:{className:"area",border:{width:1,color:"#89AFF9",style:"solid",cornerVisible:function(){return s.fillHandle&&!i.isCellEdited&&t.selection.isMultiple()}}},fill:{className:"fill",border:{width:1,color:"red",style:"solid"}}},onCellMouseDown:function(e,n,r){c=!0;var i={row:n[0],col:n[1]};if(e.button!==2||!t.selection.inInSelection(i))e.shiftKey?t.selection.setRangeEnd(i):t.selection.setRangeStart(i)},onCellMouseOver:function(e,n,r){var i={row:n[0],col:n[1]};c?t.selection.setRangeEnd(i):t.autofill.handle&&t.autofill.handle.isDragged&&(t.autofill.handle.isDragged++,t.autofill.showBorder(n))},onCellCornerMouseDown:function(e){t.autofill.handle.isDragged=1,e.preventDefault()},onCellCornerDblClick:function(e){t.autofill.selectAdjacent()}};n.PluginHooks.run(this.instance,"walkontableConfig",[p]),this.wt=new f(p),this.instance.forceFullRender=!0,this.render()},n.TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.rootElement.triggerHandler("render.handsontable"),this.instance.forceFullRender=!1},n.TableView.prototype.applyCellTypeMethod=function(e,t,r,i){var s=this.instance.colToProp(r.col),o,u=this.instance.getCellMeta(r.row,r.col);if(typeof u.type=="string")switch(u.type){case"autocomplete":u.type=n.AutocompleteCell;break;case"checkbox":u.type=n.CheckboxCell}return u.type&&typeof u.type[e]=="function"&&(o=u.type[e]),typeof o!="function"&&(o=n.TextCell[e]),o(this.instance,t,r.row,r.col,s,i,u)},n.TableView.prototype.getCellAtCoords=function(e){var t=this.wt.wtTable.getCell([e.row,e.col]);return t<0?null:t},n.TableView.prototype.scrollViewport=function(e){this.wt.scrollViewport([e.row,e.col])},n.helper.isPrintableChar=function(e){return e==32||e>=48&&e<=57||e>=96&&e<=111||e>=186&&e<=192||e>=219&&e<=222||e>=226||e>=65&&e<=90},n.helper.stringify=function(e){switch(typeof e){case"string":case"number":return e+"";case"object":return e===null?"":e.toString();case"undefined":return"";default:return e.toString()}},n.UndoRedo=function(e){var t=this;this.instance=e,this.clear(),e.rootElement.on("datachange.handsontable",function(e,n,r){r!=="undo"&&r!=="redo"&&t.add(n)})},n.UndoRedo.prototype.undo=function(){var t,n;if(this.isUndoAvailable()){var r=e.extend(!0,[],this.data[this.rev]);for(t=0,n=r.length;t<n;t++)r[t].splice(3,1);this.instance.setDataAtCell(r,null,null,"undo"),this.rev--}},n.UndoRedo.prototype.redo=function(){var t,n;if(this.isRedoAvailable()){this.rev++;var r=e.extend(!0,[],this.data[this.rev]);for(t=0,n=r.length;t<n;t++)r[t].splice(2,1);this.instance.setDataAtCell(r,null,null,"redo")}},n.UndoRedo.prototype.isUndoAvailable=function(){return this.rev>=0},n.UndoRedo.prototype.isRedoAvailable=function(){return this.rev<this.data.length-1},n.UndoRedo.prototype.add=function(e){this.rev++,this.data.splice(this.rev),this.data.push(e)},n.UndoRedo.prototype.clear=function(){this.data=[],this.rev=-1},n.SelectionPoint=function(){this._row=null,this._col=null},n.SelectionPoint.prototype.exists=function(){return this._row!==null},n.SelectionPoint.prototype.row=function(e){return e!==void 0&&(this._row=e),this._row},n.SelectionPoint.prototype.col=function(e){return e!==void 0&&(this._col=e),this._col},n.SelectionPoint.prototype.coords=function(e){return e!==void 0&&(this._row=e.row,this._col=e.col),{row:this._row,col:this._col}},n.SelectionPoint.prototype.arr=function(e){return e!==void 0&&(this._row=e[0],this._col=e[1]),[this._row,this._col]},n.TextRenderer=function(e,t,r,i,s,o,u){var a=n.helper.stringify(o);a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t.innerHTML=a.replace(/\n/g,"<br/>")},n.AutocompleteRenderer=function(t,r,i,s,o,u,a){var f=e(r),l=e('<div class="htAutocomplete"></div>'),c=e('<div class="htAutocompleteArrow">&#x25BC;</div>');c.mouseup(function(e){t.view.wt.getSetting("onCellDblClick")}),n.TextCell.renderer(t,l[0],i,s,o,u,a),l.html()===""&&l.html("&nbsp;"),l.append(c),f.empty().append(l)},n.CheckboxRenderer=function(t,r,i,s,o,u,a){typeof a.checkedTemplate=="undefined"&&(a.checkedTemplate=!0),typeof a.uncheckedTemplate=="undefined"&&(a.uncheckedTemplate=!1),u===a.checkedTemplate||u===n.helper.stringify(a.checkedTemplate)?r.innerHTML="<input type='checkbox' checked autocomplete='no'>":u===a.uncheckedTemplate||u===n.helper.stringify(a.uncheckedTemplate)?r.innerHTML="<input type='checkbox' autocomplete='no'>":u===null?r.innerHTML="<input type='checkbox' autocomplete='no' style='opacity: 0.5'>":r.innerHTML="#bad value#";var f=e(r).find("input:first");return f.mousedown(function(n){e(this).is(":checked")?t.setDataAtCell(i,o,a.uncheckedTemplate):t.setDataAtCell(i,o,a.checkedTemplate),n.stopPropagation()}),f.mouseup(function(e){e.stopPropagation()}),r};var i={isCellEdited:!1,getCaretPosition:function(e){var t=e[0];if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var n=document.selection.createRange();if(n==null)return 0;var r=t.createTextRange(),i=r.duplicate();return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),i.text.length}return 0},setCaretPosition:function(e,t){var n=e[0];if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}},beginEditing:function(e,t,r,s,o,u,a,f){if(i.isCellEdited)return;i.isCellEdited=!0;var l={row:r,col:s};e.view.scrollViewport(l),e.view.render(),u.on("cut.editor",function(e){e.stopPropagation()}),u.on("paste.editor",function(e){e.stopPropagation()});if(!e.getCellMeta(r,s).isWritable)return;if(a){var c=e.getDataAtCell(r,o);c=n.helper.stringify(c)+(f||""),u.val(c),i.setCaretPosition(u,c.length)}else u.val("");e.getSettings().asyncRendering?setTimeout(function(){i.refreshDimensions(e,r,s,u)},0):i.refreshDimensions(e,r,s,u)},refreshDimensions:function(t,n,r,s){if(!i.isCellEdited)return;var o=e(t.getCell(n,r)),u=o.offset(),a=t.rootElement.offset(),f=t.rootElement.scrollTop(),l=t.rootElement.scrollLeft(),c=u.top-a.top+f-1,h=u.left-a.left+l-1,p=t.getSettings(),d=p.rowHeaders===!1?0:1,v=p.colHeaders===!1?0:1;c<0&&(c=0),h<0&&(h=0),d>0&&parseInt(o.css("border-top-width"))>0&&(c+=1),v>0&&parseInt(o.css("border-left-width"))>0&&(h+=1),e.browser.msie&&parseInt(e.browser.version,10)<=7&&(c-=1),s.parent().addClass("htHidden").css({top:c,left:h});var m=o.width(),g=o.outerHeight()-4;parseInt(o.css("border-top-width"))>0&&(g-=1),parseInt(o.css("border-left-width"))>0&&d>0&&(m-=1),s.autoResize({maxHeight:200,minHeight:g,minWidth:m,maxWidth:Math.max(168,m),animate:!1,extraSpace:0}),s.parent().removeClass("htHidden"),t.rootElement.triggerHandler("beginediting.handsontable"),setTimeout(function(){s.parent().css({overflow:"visible"})},1)},finishEditing:function(t,n,r,s,o,u,a,f){if(i.triggerOnlyByDestroyer)return;if(i.isCellEdited){i.isCellEdited=!1;var l;a?l=[[i.originalValue]]:l=[[e.trim(u.val())]];if(f){var c=t.getSelected();t.populateFromArray({row:c[0],col:c[1]},l,{row:c[2],col:c[3]},!1,"edit")}else t.populateFromArray({row:r,col:s},l,null,!1,"edit")}u.off(".editor"),t.view.wt.update("onCellDblClick",null),u.css({width:0,height:0}),u.parent().addClass("htHidden").css({overflow:"hidden"}),t.rootElement.triggerHandler("finishediting.handsontable")}};n.TextEditor=function(t,r,s,o,u,a,f){function l(){a[0].focus(),i.beginEditing(t,null,s,o,u,a,!0)}return i.isCellEdited=!1,i.originalValue=t.getDataAtCell(s,u),i.triggerOnlyByDestroyer=f.strict,a.parent().addClass("htHidden").css({top:0,left:0,overflow:"hidden"}),a.css({width:0,height:0}),a.on("refreshBorder.editor",function(){setTimeout(function(){i.isCellEdited&&i.refreshDimensions(t,s,o,a)},0)}),a.on("keydown.editor",function(r){var f=(r.ctrlKey||r.metaKey)&&!r.altKey;if(n.helper.isPrintableChar(r.keyCode)){!i.isCellEdited&&!f?(i.beginEditing(t,null,s,o,u,a),r.stopImmediatePropagation()):f&&(i.isCellEdited&&r.keyCode===65?r.stopPropagation():i.isCellEdited&&r.keyCode===88&&e.browser.opera?r.stopPropagation():i.isCellEdited&&r.keyCode===86&&e.browser.opera&&r.stopPropagation());return}if(!(!i.isCellEdited||r.keyCode!==17&&r.keyCode!==224&&r.keyCode!==91&&r.keyCode!==93)){r.stopPropagation();return}switch(r.keyCode){case 38:i.isCellEdited&&i.finishEditing(t,null,s,o,u,a,!1);break;case 9:i.isCellEdited&&i.finishEditing(t,null,s,o,u,a,!1),r.preventDefault();break;case 39:i.isCellEdited&&(i.getCaretPosition(a)===a.val().length?i.finishEditing(t,null,s,o,u,a,!1):r.stopPropagation());break;case 37:i.isCellEdited&&(i.getCaretPosition(a)===0?i.finishEditing(t,null,s,o,u,a,!1):r.stopPropagation());break;case 8:case 46:i.isCellEdited&&r.stopPropagation();break;case 40:i.isCellEdited&&i.finishEditing(t,null,s,o,u,a,!1);break;case 27:i.isCellEdited&&(t.destroyEditor(!0),r.stopPropagation());break;case 113:i.isCellEdited||(i.beginEditing(t,null,s,o,u,a,!0),r.stopPropagation(),r.preventDefault());break;case 13:if(i.isCellEdited){var l=t.getSelected(),c=l[0]!==l[2]||l[1]!==l[3];r.ctrlKey&&!c||r.altKey?(a.val(a.val()+"\n"),a[0].focus(),r.stopPropagation()):i.finishEditing(t,null,s,o,u,a,!1,f)}else t.getSettings().enterBeginsEditing&&(f&&!selection.isMultiple()||r.altKey?i.beginEditing(t,null,s,o,u,a,!0,"\n"):i.beginEditing(t,null,s,o,u,a,!0),r.stopPropagation());r.preventDefault();break;case 36:i.isCellEdited&&r.stopPropagation();break;case 35:i.isCellEdited&&r.stopPropagation()}}),t.view.wt.update("onCellDblClick",l),function(e){i.triggerOnlyByDestroyer=!1,i.finishEditing(t,null,s,o,u,a,e)}},n.AutocompleteEditor=function(t,r,o,u,a,f,l){function g(){f[0].focus(),i.beginEditing(t,null,o,u,a,f,!0),d=!0,setTimeout(function(){f.data("typeahead").lookup()},1)}var c=f.data("typeahead"),h,p,d=!1;c?(c.$menu.off(),f.off(),c.listen()):(f.typeahead(),c=f.data("typeahead"),c._show=c.show,c._hide=c.hide,c._render=c.render,c._highlighter=c.highlighter),c.minLength=0,c.highlighter=c._highlighter,c.show=function(){if(f.parent().hasClass("htHidden"))return;return c._show.call(this)},c.hide=function(){if(!d)return d=!1,c._hide.call(this)},c.lookup=function(){var t;return this.query=this.$element.val(),t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this},c.matcher=function(){return!0},c.select=function(){var e=this.$menu.find(".active").attr("data-value")||f.val();return y(!0),t.setDataAtCell(o,a,c.updater(e)),this.hide()},c.render=function(e){return c._render.call(this,e),l.strict||this.$menu.find("li:eq(0)").removeClass("active"),this};for(h in l)if(l.hasOwnProperty(h))if(h==="options")for(p in l.options)l.options.hasOwnProperty(p)&&(c.options[p]=l.options[p]);else c[h]=l[h];var v=!1;f.on("keydown.editor",function(e){switch(e.keyCode){case 27:d=!1;break;case 37:case 39:case 38:case 40:case 9:case 13:f.parent().hasClass("htHidden")||e.stopImmediatePropagation(),e.preventDefault()}}),f.on("keyup.editor",function(t){switch(t.keyCode){case 9:case 13:if(!v&&!s(f)){var r=e.Event("keyup");r.keyCode=113,f.trigger(r)}else setTimeout(function(){var n=e.Event("keydown");n.keyCode=t.keyCode,f.parent().trigger(n)},10);break;default:!v&&!n.helper.isPrintableChar(t.keyCode)&&t.stopImmediatePropagation()}});var m=n.TextEditor(t,r,o,u,a,f,l);t.view.wt.update("onCellDblClick",g);var y=function(e){v=!0,f.off(),m(e),d=!1,s(f)&&s(f).hide()};return y},n.CheckboxEditor=function(e,t,r,i,s,u,a){function f(){o(e,r,s,a)}return typeof a=="undefined"&&(a={}),typeof a.checkedTemplate=="undefined"&&(a.checkedTemplate=!0),typeof a.uncheckedTemplate=="undefined"&&(a.uncheckedTemplate=!1),u.on("keydown.editor",function(t){var i=(t.ctrlKey||t.metaKey)&&!t.altKey;!i&&n.helper.isPrintableChar(t.keyCode)&&(o(e,r,s,a),t.stopPropagation())}),e.view.wt.update("onCellDblClick",f),function(){u.off(".editor"),e.view.wt.update("onCellDblClick",null)}},n.AutocompleteCell={renderer:n.AutocompleteRenderer,editor:n.AutocompleteEditor},n.CheckboxCell={renderer:n.CheckboxRenderer,editor:n.CheckboxEditor},n.TextCell={renderer:n.TextRenderer,editor:n.TextEditor},n.PluginHooks={hooks:{afterInit:[],afterGetCellMeta:[],walkontableConfig:[]},push:function(e,t){this.hooks[e].push(t)},unshift:function(e,t){this.hooks[e].unshift(t)},run:function(e,t,n){for(var r=0,i=this.hooks[t].length;r<i;r++)n?this.hooks[t][r].apply(e,n):this.hooks[t][r].call(e)}},n.PluginHooks.push("afterInit",u),n.PluginHooks.push("afterGetCellMeta",function(e,t,r){var i=this.getSettings(),s=this.getData(),o,u,a;if(i.autoComplete)for(o=0,u=i.autoComplete.length;o<u;o++)if(i.autoComplete[o].match(e,t,s)){typeof r.type=="undefined"?r.type=n.AutocompleteCell:(typeof r.type.renderer=="undefined"&&(r.type.renderer=n.AutocompleteCell.renderer),typeof r.type.editor=="undefined"&&(r.type.editor=n.AutocompleteCell.editor));for(a in i.autoComplete[o])i.autoComplete[o].hasOwnProperty(a)&&a!=="match"&&typeof r[o]=="undefined"&&(a==="source"?r[a]=i.autoComplete[o][a](e,t):r[a]=i.autoComplete[o][a]);break}}),function(e){function t(r){return this.filter(t.resizableFilterSelector).each(function(){new n(e(this),r)}),this}function n(n,r){if(this.clones)return;this.config=e.extend({},t.defaults,r),this.el=n,this.nodeName=n[0].nodeName.toLowerCase(),this.previousScrollTop=null,r.maxWidth==="original"&&(r.maxWidth=n.width()),r.minWidth==="original"&&(r.minWidth=n.width()),r.maxHeight==="original"&&(r.maxHeight=n.height()),r.minHeight==="original"&&(r.minHeight=n.height()),this.nodeName==="textarea"&&n.css({resize:"none",overflowY:"hidden"}),n.data("AutoResizer",this),this.createClone(),this.injectClone(),this.bind()}t.defaults={onResize:function(){},animate:{duration:200,complete:function(){}},extraSpace:50,minHeight:"original",maxHeight:500,minWidth:"original",maxWidth:500},t.cloneCSSProperties=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","padding"],t.cloneCSSValues={position:"absolute",top:-9999,left:-9999,opacity:0,overflow:"hidden",border:"1px solid black",padding:"0.49em"},t.resizableFilterSelector="textarea,input:not(input[type]),input[type=text],input[type=password]",t.AutoResizer=n,e.fn.autoResize=t,n.prototype={bind:function(){var t=e.proxy(function(){return this.check(),!0},this);this.unbind(),this.el.bind("keyup.autoResize",t).bind("change.autoResize",t),this.check(null,!0)},unbind:function(){this.el.unbind(".autoResize")},createClone:function(){var n=this.el,r=this,i=this.config;this.clones=e();if(i.minHeight!=="original"||i.maxHeight!=="original")this.hClone=n.clone().height("auto"),this.clones=this.clones.add(this.hClone);if(i.minWidth!=="original"||i.maxWidth!=="original")this.wClone=e("<div/>").width("auto").css({whiteSpace:"nowrap","float":"left"}),this.clones=this.clones.add(this.wClone);e.each(t.cloneCSSProperties,function(e,t){r.clones.css(t,n.css(t))}),this.clones.removeAttr("name").removeAttr("id").attr("tabIndex",-1).css(t.cloneCSSValues)},check:function(e,t){var n=this.config,r=this.wClone,i=this.hClone,s=this.el,o=s.val();if(r){r.text(o);var u=r.outerWidth(),a=u+n.extraSpace>=n.minWidth?u+n.extraSpace:n.minWidth,f=s.width();a=Math.min(a,n.maxWidth);if(a<f&&a>=n.minWidth||a>=n.minWidth&&a<=n.maxWidth)n.onResize.call(s),s.scrollLeft(0),n.animate&&!t?s.stop(1,1).animate({width:a},n.animate):s.width(a)}if(i){a&&i.width(a),i.height(0).val(o).scrollTop(1e4);var l=i[0].scrollTop+n.extraSpace;if(this.previousScrollTop===l)return;this.previousScrollTop=l;if(l>=n.maxHeight){s.css("overflowY","");return}s.css("overflowY","hidden"),l<n.minHeight&&(l=n.minHeight),n.onResize.call(s),n.animate&&!t?s.stop(1,1).animate({height:l},n.animate):s.height(l)}},destroy:function(){this.unbind(),this.el.removeData("AutoResizer"),this.clones.remove(),delete this.el,delete this.hClone,delete this.wClone,delete this.clones},injectClone:function(){(t.cloneContainer||(t.cloneContainer=e("<arclones/>").appendTo("body"))).append(this.clones)}}}(jQuery),function(e){function t(e){return e.split('"').length-1}e.SheetClip={parse:function(e){var n,r,i,s=[],o=0,u,a,f,l;i=e.split("\n"),i.length>1&&i[i.length-1]===""&&i.pop();for(n=0,r=i.length;n<r;n+=1){i[n]=i[n].split("	");for(u=0,a=i[n].length;u<a;u+=1)s[o]||(s[o]=[]),f&&u===0?(l=s[o].length-1,s[o][l]=s[o][l]+"\n"+i[n][0],f&&t(i[n][0])%2===1&&(f=!1,s[o][l]=s[o][l].substring(0,s[o][l].length-1).replace(/""/g,'"'))):u===a-1&&i[n][u].indexOf('"')===0?(s[o].push(i[n][u].substring(1).replace(/""/g,'"')),f=!0):(s[o].push(i[n][u].replace(/""/g,'"')),f=!1);f||(o+=1)}return s},stringify:function(e){var t,n,r,i,s="",o;for(t=0,n=e.length;t<n;t+=1){for(r=0,i=e[t].length;r<i;r+=1)r>0&&(s+="	"),o=e[t][r],typeof o=="string"?o.indexOf("\n")>-1?s+='"'+o.replace(/"/g,'""')+'"':s+=o:o===null||o===void 0?s+="":s+=o;s+="\n"}return s}}}(t),a.prototype.appear=function(t){var n,r,i,s,o,u,a,f,l,c,h,p;if(this.disabled)return;var d=this.instance.getSetting("offsetRow"),v=this.instance.getSetting("offsetColumn"),m=this.instance.getSetting("displayRows"),g=this.instance.getSetting("displayColumns"),y=!1,b=!1,w=!1,E=!1;m!==null&&(t[0]>d+m-1||t[2]<d?y=b=w=E=!0:(t[0]<d&&(t[0]=d,y=!0),t[2]>d+m-1&&(t[2]=d+m-1,w=!0))),g!==null&&(t[1]>v+g-1||t[3]<v?y=b=w=E=!0:(t[1]<v&&(t[1]=v,b=!0),t[3]>v+g-1&&(t[3]=v+g-1,E=!0))),y+b+w+E<4&&(n=t[0]!==t[2]||t[1]!==t[3],r=e(this.instance.wtTable.getCell([t[0],t[1]])),i=n?e(this.instance.wtTable.getCell([t[2],t[3]])):r,s=this.wtDom.offset(r[0]),o=n?this.wtDom.offset(i[0]):s,u=this.wtDom.offset(this.instance.wtTable.TABLE),f=s.top,h=o.top+i.outerHeight()-f,c=s.left,p=o.left+i.outerWidth()-c,a=f-u.top-1,l=c-u.left-1,parseInt(r.css("border-top-width"))>0&&(a+=1,h-=1),parseInt(r.css("border-left-width"))>0&&(l+=1,p-=1)),y?this.top.style.display="none":(this.top.style.top=a+"px",this.top.style.left=l+"px",this.top.style.width=p+"px",this.top.style.display="block"),b?this.left.style.display="none":(this.left.style.top=a+"px",this.left.style.left=l+"px",this.left.style.height=h+"px",this.left.style.display="block");var S=Math.floor(this.settings.border.width/2);w?this.bottom.style.display="none":(this.bottom.style.top=a+h-S+"px",this.bottom.style.left=l+"px",this.bottom.style.width=p+"px",this.bottom.style.display="block"),E?this.right.style.display="none":(this.right.style.top=a+"px",this.right.style.left=l+p-S+"px",this.right.style.height=h+1+"px",this.right.style.display="block"),w&&E||!this.hasSetting(this.settings.border.cornerVisible)?this.corner.style.display="none":(this.corner.style.top=a+h-4+"px",this.corner.style.left=l+p-4+"px",this.corner.style.display="block")},a.prototype.disappear=function(){this.top.style.display="none",this.left.style.display="none",this.bottom.style.display="none",this.right.style.display="none",this.corner.style.display="none"},a.prototype.hasSetting=function(e){return typeof e=="function"?e():!!e},f.prototype.draw=function(e){if(this.hasSetting("async")){var t=this;t.drawFrame=setTimeout(function(){t._doDraw(e)},0)}else this._doDraw(e);return this},f.prototype._doDraw=function(e){e=e&&this.settings.offsetRow===this.lastOffsetRow&&this.settings.offsetColumn===this.lastOffsetColumn,this.lastOffsetRow=this.settings.offsetRow,this.lastOffsetColumn=this.settings.offsetColumn,this.wtTable.draw(e)},f.prototype.update=function(e,t){if(t===void 0)for(var n in e)e.hasOwnProperty(n)&&(this.settings[n]=e[n]);else this.settings[e]=t;return this},f.prototype.scrollVertical=function(e){return this.wtScroll.scrollVertical(e)},f.prototype.scrollHorizontal=function(e){return this.wtScroll.scrollHorizontal(e)},f.prototype.scrollViewport=function(e){if(this.hasSetting("async")){var t=this;clearTimeout(t.scrollFrame),t.scrollFrame=setTimeout(function(){t.wtScroll.scrollViewport(e)},0)}else this.wtScroll.scrollViewport(e);return this},f.prototype.getSetting=function(e,t,n,r){var i,s;return e==="displayRows"&&this.settings.height?(i=Math.floor(this.settings.height/20),s=this.getSetting("totalRows")-this.getSetting("offsetRow"),s<0?(this.update("offsetRow",Math.max(0,this.getSetting("totalRows")-i)),i):Math.min(i,s)):e==="displayColumns"&&this.settings.width?(i=Math.floor(this.settings.width/50),s=this.getSetting("totalColumns")-this.getSetting("offsetColumn"),s<0?(this.update("offsetColumn",Math.max(0,this.getSetting("totalColumns")-i)),i):Math.min(i,s)):e==="displayRows"&&this.settings.displayRows===null?this.getSetting("totalRows"):e==="displayColumns"&&this.settings.displayColumns===null?this.settings.rowHeaders?this.getSetting("totalColumns")+1:this.getSetting("totalColumns"):e==="viewportRows"?this.wtTable.visibilityEdgeRow?this.wtTable.visibilityEdgeRow-this.getSetting("offsetRow"):this.getSetting("displayRows"):e==="viewportColumns"?this.wtTable.visibilityEdgeColumn?this.wtTable.visibilityEdgeColumn-this.getSetting("offsetColumn"):this.getSetting("displayColumns"):typeof this.settings[e]=="function"?this.settings[e](t,n,r):t!==void 0&&Object.prototype.toString.call(this.settings[e])==="[object Array]"&&t!==void 0?this.settings[e][t]:this.settings[e]},f.prototype.hasSetting=function(e){return!!this.settings[e]},l.prototype.closest=function(e,t){while(e!=null){if(e.nodeType===1&&t.indexOf(e.nodeName)>-1)return e;e=e.parentNode}return null},l.prototype.prevSiblings=function(e){var t=[];while((e=e.previousSibling)!=null)e.nodeType===1&&t.push(e);return t},l.prototype.hasClass=function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},l.prototype.addClass=function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},l.prototype.removeClass=function(e,t){if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}},l.prototype.removeTextNodes=function(e,t){if(e.nodeType===3)t.removeChild(e);else if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(e.nodeName)>-1){var n=e.childNodes;for(var r=n.length-1;r>=0;r--)this.removeTextNodes(n[r],e)}},l.prototype.offset=function(e){var t=e.offsetLeft,n=e.offsetTop;while(e=e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop;return{left:t,top:n}},c.prototype.parentCell=function(e){var t={};return t.TD=this.wtDom.closest(e,["TD","TH"]),t.TD?t.coords=this.instance.wtTable.getCoords(t.TD):!t.TD&&this.wtDom.hasClass(e,"wtBorder")&&this.wtDom.hasClass(e,"current")&&!this.wtDom.hasClass(e,"corner")&&(t.coords=this.instance.selections.current.selected[0],t.TD=this.instance.wtTable.getCell(t.coords)),t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1}),t.requestAnimFrame=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,n){return t.setTimeout(e,1e3/60)}}(),t.cancelRequestAnimFrame=function(){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout}(),h.prototype.refreshScrollbars=function(){this.wtScrollbarV&&this.wtScrollbarV.refresh(),this.wtScrollbarH&&this.wtScrollbarH.refresh()},h.prototype.scrollVertical=function(e){var t=this.instance.getSetting("offsetRow"),n,r=this.instance.getSetting("totalRows")-this.instance.getSetting("viewportRows");return r<0&&(r=0),n=t+e,n<0?n=0:n>=r&&(n=r),n!==t&&this.instance.update("offsetRow",n),this.instance},h.prototype.scrollHorizontal=function(e){var t=this.instance.getSetting("viewportColumns");if(t!==null){var n=this.instance.getSetting("offsetColumn"),r,i=this.instance.getSetting("totalColumns")-t;i<0&&(i=0),r=n+e,r<0?r=0:r>=i&&(r=i),r!==n&&this.instance.update("offsetColumn",r)}return this.instance},h.prototype.scrollViewport=function(e){var t=this.instance.getSetting("offsetRow"),n=this.instance.getSetting("offsetColumn"),r=this.instance.getSetting("viewportRows"),i=this.instance.getSetting("viewportColumns"),s=this.instance.getSetting("totalRows"),o=this.instance.getSetting("totalColumns");if(e[0]<0||e[0]>s-1)throw new Error("row "+e[0]+" does not exist");if(e[1]<0||e[1]>o-1)throw new Error("column "+e[1]+" does not exist");return r<s?e[0]>t+r-1?this.scrollVertical(e[0]-(t+r-1)):e[0]<t?this.scrollVertical(e[0]-t):this.scrollVertical(0):this.scrollVertical(0),i>0&&i<o?e[1]>n+i-1?this.scrollHorizontal(e[1]-(n+i-1)):e[1]<n?this.scrollHorizontal(e[1]-n):this.scrollHorizontal(0):this.scrollHorizontal(0),this.instance},p.prototype.onScroll=function(e){if(this.instance.drawn){var t=this.type==="vertical"?["offsetRow","totalRows","viewportRows"]:["offsetColumn","totalColumns","viewportColumns"],n=this.instance.getSetting(t[1]),r=this.instance.getSetting(t[2]);if(n>r){var i=Math.max(0,Math.round((n-r)*e));i!==this.instance.getSetting(t[0])&&(this.instance.update(t[0],i),this.instance.draw())}}},p.prototype.refresh=function(){if(this.skipRefresh)return;var t=1,n,r,i=this.instance.getSetting("offsetRow"),s=this.instance.getSetting("offsetColumn"),o=this.instance.getSetting("totalRows"),u=this.instance.getSetting("totalColumns"),a=this.instance.hasSetting("width")?this.instance.getSetting("width")-this.instance.getSetting("scrollbarWidth"):this.$table.outerWidth(),f=this.instance.hasSetting("height")?this.instance.getSetting("height")-this.instance.getSetting("scrollbarHeight"):this.$table.outerHeight(),l=Math.min(this.instance.getSetting("viewportRows"),o),c=Math.min(this.instance.getSetting("viewportColumns"),u);if(!a)throw new Error("I could not compute table width. Is the <table> element attached to the DOM?");if(!f)throw new Error("I could not compute table height. Is the <table> element attached to the DOM?");this.type==="vertical"?(this.slider.style.top=this.$table.position().top+"px",this.slider.style.left=a-1+"px",this.slider.style.height=f-2+"px",o&&(t=l/o),n=Math.round(e(this.slider).height()*t),n<10&&(n=30),this.handle.style.height=n+"px",r=Math.round((f-n)*(i/o)),r>f-n&&(r=f-n),this.handle.style.top=r+"px"):this.type==="horizontal"&&(this.slider.style.left=this.$table.position().left+"px",this.slider.style.top=f-1+"px",this.slider.style.width=a-2+"px",u&&(t=c/u),n=Math.round(e(this.slider).width()*t),n<10&&(n=30),this.handle.style.width=n+"px",r=Math.round((a-n)*(s/u)),r>a-n&&(r=a-n),this.handle.style.left=r+"px"),this.dragdealer.setWrapperOffset(),this.dragdealer.setBounds()},d.prototype.add=function(e){this.selected.push(e)},d.prototype.remove=function(e){var t=this.isSelected(e);t>-1&&this.selected.splice(t,1)},d.prototype.clear=function(){this.selected.length=0},d.prototype.isSelected=function(e){for(var t=0,n=this.selected.length;t<n;t++)if(this.selected[t][0]===e[0]&&this.selected[t][1]===e[1])return t;return-1},d.prototype.getSelected=function(){return this.selected},d.prototype.getCorners=function(){var e,t,n,r,i,s=this.selected.length;if(s>0){e=n=this.selected[0][0],t=r=this.selected[0][1];if(s>1)for(i=1;i<s;i++)this.selected[i][0]<e?e=this.selected[i][0]:this.selected[i][0]>n&&(n=this.selected[i][0]),this.selected[i][1]<t?t=this.selected[i][1]:this.selected[i][1]>r&&(r=this.selected[i][1])}return[e,t,n,r]},d.prototype.draw=function(e){var t,n,r,i,s,o,u;if(e&&this.settings.className){t=this.instance.wtTable.TABLE.getElementsByTagName("TD");for(r=0,i=t.length;r<i;r++)this.instance.wtDom.removeClass(t[r],this.settings.className)}i=this.selected.length;if(i){s=this.getCorners(),o=s[0];e:while(o<=s[2]){u=s[1];while(u<=s[3]){n=this.instance.wtTable.getCell([o,u]);if(n===-2)break e;if(n===-4)break;n!==-1&&n!==-3&&this.onAdd([o,u],n),u++}o++}}this.border&&(i>0?this.border.appear(s):this.border.disappear(s))},v.prototype.adjustAvailableNodes=function(){var e=this.instance.getSetting("totalRows"),t=this.instance.getSetting("totalColumns"),n=this.instance.getSetting("displayRows"),r=this.instance.getSetting("displayColumns"),i,s=this.instance.getSetting("frozenColumns"),o=s?s.length:0,u,a;n=Math.min(n,e),i=Math.min(r,t);while(this.colgroupChildrenLength<i+o)this.COLGROUP.appendChild(document.createElement("COL")),this.colgroupChildrenLength++;while(this.colgroupChildrenLength>i+o)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.colgroupChildrenLength--;if(this.instance.hasSetting("columnHeaders")){while(this.theadChildrenLength<i+o)this.THEAD.firstChild.appendChild(document.createElement("TH")),this.theadChildrenLength++;while(this.theadChildrenLength>i+o)this.THEAD.firstChild.removeChild(this.THEAD.firstChild.lastChild),this.theadChildrenLength--}while(this.tbodyChildrenLength<n){u=document.createElement("TR");for(a=0;a<o;a++)u.appendChild(document.createElement("TH"));for(a=0;a<i;a++)u.appendChild(document.createElement("TD"));this.TBODY.appendChild(u),this.tbodyChildrenLength++}while(this.tbodyChildrenLength>n)this.TBODY.removeChild(this.TBODY.lastChild),this.tbodyChildrenLength--;var f=this.TBODY.childNodes,l;for(var c=0,h=f.length;c<h;c++){l=f[c].childNodes.length;while(l<i+o)f[c].appendChild(document.createElement("TD")),l++;while(l>i+o)f[c].removeChild(f[c].lastChild),l--}},v.prototype.draw=function(e){e||(this.tableOffset=this.wtDom.offset(this.TABLE),this.adjustAvailableNodes(),this._doDraw(e));if(this.instance.hasSetting("async")){var n=this;t.cancelRequestAnimFrame(this.selectionsFrame),n.selectionsFrame=t.requestAnimFrame(function(){n.refreshPositions(e)})}else this.refreshPositions(e);return this.instance.drawn=!0,this},v.prototype._doDraw=function(){var e,t,n=this.instance.getSetting("offsetRow"),r=this.instance.getSetting("offsetColumn"),i=this.instance.getSetting("totalRows"),s=this.instance.getSetting("totalColumns"),o=this.instance.getSetting("displayRows"),u=this.instance.getSetting("displayColumns"),a,f=this.instance.getSetting("frozenColumns"),l=f?f.length:0,c,h,p,d;o=Math.min(o,i),a=Math.min(u,s);for(t=0;t<this.colgroupChildrenLength;t++)t<l?(this.wtDom.addClass(this.COLGROUP.childNodes[t],"rowHeader"),typeof f[t]=="function"&&f[t](null,this.COLGROUP.childNodes[t])):this.wtDom.removeClass(this.COLGROUP.childNodes[t],"rowHeader");var v;if(this.instance.hasSetting("columnWidth"))for(t=0;t<a;t++)v=this.instance.getSetting("columnWidth",r+t),v?this.COLGROUP.childNodes[t+l].style.width=this.instance.getSetting("columnWidth",r+t)+"px":this.COLGROUP.childNodes[t+l].style.width="";if(l&&this.instance.hasSetting("columnHeaders"))for(t=0;t<l;t++)h=this.THEAD.childNodes[0].childNodes[t],typeof f[t]=="function"?f[t](null,h):h.innerHTML="",this.hasEmptyCellProblem&&h.innerHTML===""&&(h.innerHTML="&nbsp;");if(this.instance.hasSetting("columnHeaders"))for(t=0;t<a;t++)this.THEAD.childNodes[0].childNodes[l+t].innerHTML=this.instance.getSetting("columnHeaders",r+t);this.visibilityEdgeRow=this.visibilityEdgeColumn=null;e:for(e=0;e<o;e++){c=this.TBODY.childNodes[e];for(t=0;t<l;t++)h=c.childNodes[t],d=typeof f[t]=="function"?f[t](n+e,h):f[t],d!==void 0&&(h.innerHTML=d);for(t=0;t<a;t++){p=c.childNodes[t+l];var m=this.isCellVisible(p);this.visibilityEdgeRow===null&&this.visibilityEdgeColumn===null&&m===1&&t!==0&&(this.visibilityEdgeColumn=r+t),this.visibilityEdgeRow===null&&m===1&&t===0&&(this.visibilityEdgeRow=n+e);if(!!this.instance.drawn&&!m){if(t===0)break e;break}p.className="",this.instance.getSetting("cellRenderer",n+e,r+t,p),this.hasEmptyCellProblem&&p.innerHTML===""&&(p.innerHTML="&nbsp;")}}this.refreshSelections()},v.prototype.refreshPositions=function(e){e&&this.refreshSelections(e),this.instance.wtScroll.refreshScrollbars()},v.prototype.refreshSelections=function(e){var t;if(this.instance.selections)for(t in this.instance.selections)this.instance.selections.hasOwnProperty(t)&&this.instance.selections[t].draw(e)},v.prototype.isCellVisible=function(t){var n=this.instance.getSetting("offsetRow"),r=this.instance.getSetting("offsetColumn"),i=this.instance.getSetting("displayRows"),s=this.instance.getSetting("displayColumns"),o=this.instance.getSetting("frozenColumns"),u,a=this.wtDom.offset(t),f=this.tableOffset,l=a.top-f.top,c=a.left-f.left,h=e(t).outerWidth(),p=e(t).outerHeight(),d=this.instance.hasSetting("width")?this.instance.getSetting("width")-this.instance.getSetting("scrollbarWidth"):e(this.TABLE).outerWidth(),v=this.instance.hasSetting("height")?this.instance.getSetting("height")-this.instance.getSetting("scrollbarHeight"):e(this.TABLE).outerHeight();return l>v?u=0:c>d?u=0:l+p>v?u=1:c+h>d?u=1:u=2,u},v.prototype.getCell=function(e){var t=this.instance.getSetting("offsetRow");if(e[0]<t)return-1;if(e[0]>t+this.instance.getSetting("displayRows")-1)return-2;var n=this.instance.getSetting("offsetColumn");if(e[1]<n)return-3;if(e[1]>n+this.instance.getSetting("displayColumns")-1)return-4;var r=this.instance.getSetting("frozenColumns"),i=r?r.length:0;return this.TBODY.childNodes[e[0]-t].childNodes[e[1]-n+i]},v.prototype.getCoords=function(e){var t=this.instance.getSetting("frozenColumns"),n=t?t.length:0;return[this.wtDom.prevSiblings(e.parentNode).length+this.instance.getSetting("offsetRow"),e.cellIndex+this.instance.getSetting("offsetColumn")-n]};var g={x:0,y:0,init:function(){this.setEvent("mouse"),this.setEvent("touch")},setEvent:function(e){var t=document["on"+e+"move"]||function(){};document["on"+e+"move"]=function(e){t(e),g.refresh(e)}},refresh:function(e){e||(e=t.event),e.type=="mousemove"?this.set(e):e.touches&&this.set(e.touches[0])},set:function(e){if(e.pageX||e.pageY)this.x=e.pageX,this.y=e.pageY;else if(e.clientX||e.clientY)this.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}};g.init();var y={get:function(e){var t=0,n=0;if(e.offsetParent)do n+=e.offsetLeft,t+=e.offsetTop;while(e=e.offsetParent);return[n,t]}},b=function(e,t){typeof e=="string"&&(e=document.getElementById(e));if(!e)return;var n=e.getElementsByTagName("div")[0];if(!n||n.className.search(/(^|\s)handle(\s|$)/)==-1)return;this.init(e,n,t||{}),this.setup()};b.prototype={init:function(e,t,n){this.wrapper=e,this.handle=t,this.options=n,this.disabled=this.getOption("disabled",!1),this.horizontal=this.getOption("horizontal",!0),this.vertical=this.getOption("vertical",!1),this.slide=this.getOption("slide",!0),this.steps=this.getOption("steps",0),this.snap=this.getOption("snap",!1),this.loose=this.getOption("loose",!1),this.speed=this.getOption("speed",10)/100,this.xPrecision=this.getOption("xPrecision",0),this.yPrecision=this.getOption("yPrecision",0),this.callback=n.callback||null,this.animationCallback=n.animationCallback||null,this.bounds={left:n.left||0,right:-(n.right||0),top:n.top||0,bottom:-(n.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0},this.value={prev:[-1,-1],current:[n.x||0,n.y||0],target:[n.x||0,n.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.activity=!1,this.dragging=!1,this.tapping=!1},getOption:function(e,t){return this.options[e]!==undefined?this.options[e]:t},setup:function(){this.setWrapperOffset(),this.setBoundsPadding(),this.setBounds(),this.setSteps(),this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=y.get(this.wrapper)},setBoundsPadding:function(){!this.bounds.left&&!this.bounds.right&&(this.bounds.left=y.get(this.handle)[0]-this.offset.wrapper[0],this.bounds.right=-this.bounds.left),!this.bounds.top&&!this.bounds.bottom&&(this.bounds.top=y.get(this.handle)[1]-this.offset.wrapper[1],this.bounds.bottom=-this.bounds.top)},setBounds:function(){this.bounds.x0=this.bounds.left,this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right,this.bounds.xRange=this.bounds.x1-this.bounds.x0-this.handle.offsetWidth,this.bounds.y0=this.bounds.top,this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom,this.bounds.yRange=this.bounds.y1-this.bounds.y0-this.handle.offsetHeight,this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth)),this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var e=0;e<=this.steps-1;e++)this.stepRatios[e]=e/(this.steps-1)}},addListeners:function(){var e=this;this.wrapper.onselectstart=function(){return!1},this.handle.onmousedown=this.handle.ontouchstart=function(t){e.handleDownHandler(t)},this.wrapper.onmousedown=this.wrapper.ontouchstart=function(t){e.wrapperDownHandler(t)};var n=document.onmouseup||function(){};document.onmouseup=function(t){n(t),e.documentUpHandler(t)};var r=document.ontouchend||function(){};document.ontouchend=function(t){r(t),e.documentUpHandler(t)};var i=t.onresize||function(){};t.onresize=function(t){i(t),e.documentResizeHandler(t)},this.wrapper.onmousemove=function(t){e.activity=!0},this.wrapper.onclick=function(t){return!e.activity},this.interval=setInterval(function(){e.animate()},25),e.animate(!1,!0)},handleDownHandler:function(e){this.activity=!1,g.refresh(e),this.preventDefaults(e,!0),this.startDrag(),this.cancelEvent(e)},wrapperDownHandler:function(e){g.refresh(e),this.preventDefaults(e,!0),this.startTap()},documentUpHandler:function(e){this.stopDrag(),this.stopTap()},documentResizeHandler:function(e){this.setWrapperOffset(),this.setBounds(),this.update()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},setStep:function(e,t,n){this.setValue(this.steps&&e>1?(e-1)/(this.steps-1):0,this.steps&&t>1?(t-1)/(this.steps-1):0,n)},setValue:function(e,t,n){this.setTargetValue([e,t||0]),n&&this.groupCopy(this.value.current,this.value.target)},startTap:function(e){if(this.disabled)return;this.tapping=!0,e===undefined&&(e=[g.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,g.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]),this.setTargetOffset(e)},stopTap:function(){if(this.disabled||!this.tapping)return;this.tapping=!1,this.setTargetValue(this.value.current),this.result()},startDrag:function(){if(this.disabled)return;this.offset.mouse=[g.x-y.get(this.handle)[0],g.y-y.get(this.handle)[1]],this.dragging=!0},stopDrag:function(){if(this.disabled||!this.dragging)return;this.dragging=!1;var e=this.groupClone(this.value.current);if(this.slide){var t=this.change;e[0]+=t[0]*4,e[1]+=t[1]*4}this.setTargetValue(e),this.result()},feedback:function(){var e=this.value.current;this.snap&&this.steps>1&&(e=this.getClosestSteps(e)),this.groupCompare(e,this.value.prev)||(typeof this.animationCallback=="function"&&this.animationCallback(e[0],e[1]),this.groupCopy(this.value.prev,e))},result:function(){typeof this.callback=="function"&&this.callback(this.value.target[0],this.value.target[1])},animate:function(e,t){if(e&&!this.dragging)return;if(this.dragging){var n=this.groupClone(this.value.target),r=[g.x-this.offset.wrapper[0]-this.offset.mouse[0],g.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(r,this.loose),this.change=[this.value.target[0]-n[0],this.value.target[1]-n[1]]}(this.dragging||t)&&this.groupCopy(this.value.current,this.value.target);if(this.dragging||this.glide()||t)this.update(),this.feedback()},glide:function(){var e=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return!e[0]&&!e[1]?!1:(Math.abs(e[0])>this.bounds.xStep||Math.abs(e[1])>this.bounds.yStep?(this.value.current[0]+=e[0]*this.speed,this.value.current[1]+=e[1]*this.speed):this.groupCopy(this.value.current,this.value.target),!0)},update:function(){this.snap?this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.offset.current=this.getOffsetsByRatios(this.value.current),this.show()},show:function(){this.groupCompare(this.offset.current,this.offset.prev)||(this.horizontal&&(this.handle.style.left=String(this.offset.current[0])+"px"),this.vertical&&(this.handle.style.top=String(this.offset.current[1])+"px"),this.groupCopy(this.offset.prev,this.offset.current))},setTargetValue:function(e,t){var n=t?this.getLooseValue(e):this.getProperValue(e);this.groupCopy(this.value.target,n),this.offset.target=this.getOffsetsByRatios(n)},setTargetOffset:function(e,t){var n=this.getRatiosByOffsets(e),r=t?this.getLooseValue(n):this.getProperValue(n);this.groupCopy(this.value.target,r),this.offset.target=this.getOffsetsByRatios(r)},getLooseValue:function(e){var t=this.getProperValue(e);return[t[0]+(e[0]-t[0])/4,t[1]+(e[1]-t[1])/4]},getProperValue:function(e){var t=this.groupClone(e);return t[0]=Math.max(t[0],0),t[1]=Math.max(t[1],0),t[0]=Math.min(t[0],1),t[1]=Math.min(t[1],1),(!this.dragging&&!this.tapping||this.snap)&&this.steps>1&&(t=this.getClosestSteps(t)),t},getRatiosByOffsets:function(e){return[this.getRatioByOffset(e[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(e[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(e,t,n){return t?(e-n)/t:0},getOffsetsByRatios:function(e){return[this.getOffsetByRatio(e[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(e[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(e,t,n){return Math.round(e*t)+n},getClosestSteps:function(e){return[this.getClosestStep(e[0]),this.getClosestStep(e[1])]},getClosestStep:function(e){var t=0,n=1;for(var r=0;r<=this.steps-1;r++)Math.abs(this.stepRatios[r]-e)<n&&(n=Math.abs(this.stepRatios[r]-e),t=r);return this.stepRatios[t]},groupCompare:function(e,t){return e[0]==t[0]&&e[1]==t[1]},groupCopy:function(e,t){e[0]=t[0],e[1]=t[1]},groupClone:function(e){return[e[0],e[1]]},preventDefaults:function(e,n){e||(e=t.event),e.preventDefault&&e.preventDefault(),e.returnValue=!1,n&&document.selection&&document.selection.empty()},cancelEvent:function(e){e||(e=t.event),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}},function(e){function i(n){var r=n||t.event,i=[].slice.call(arguments,1),s=0,o=!0,u=0,a=0;return n=e.event.fix(r),n.type="mousewheel",r.wheelDelta&&(s=r.wheelDelta/120),r.detail&&(s=-r.detail/3),a=s,r.axis!==undefined&&r.axis===r.HORIZONTAL_AXIS&&(a=0,u=-1*s),r.wheelDeltaY!==undefined&&(a=r.wheelDeltaY/120),r.wheelDeltaX!==undefined&&(u=-1*r.wheelDeltaX/120),i.unshift(n,s,u,a),(e.event.dispatch||e.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],i,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery)})(jQuery,window,Handsontable),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.chrome||e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),function(e,t){function d(e){var t=e.split(/\s+/),n=[];for(var r=0,i;i=t[r];r++)i=i[0].toUpperCase(),n.push(i);return n}function v(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function m(n,r,i){return i||(i=0),r.each(function(){var r=e(this),s=this,o=this.nodeName.toLowerCase(),u,a;o=="label"&&r.find("input, textarea, select").length&&(u=r.text(),r=r.children().first(),s=r.get(0),o=s.nodeName.toLowerCase());switch(o){case"menu":a={name:r.attr("label"),items:{}},i=m(a.items,r.children(),i);break;case"a":case"button":a={name:r.text(),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"menuitem":case"command":switch(r.attr("type")){case t:case"command":case"menuitem":a={name:r.attr("label"),disabled:!!r.attr("disabled"),callback:function(){return function(){r.click()}}()};break;case"checkbox":a={type:"checkbox",disabled:!!r.attr("disabled"),name:r.attr("label"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",disabled:!!r.attr("disabled"),name:r.attr("label"),radio:r.attr("radiogroup"),value:r.attr("id"),selected:!!r.attr("checked")};break;default:a=t}break;case"hr":a="-------";break;case"input":switch(r.attr("type")){case"text":a={type:"text",name:u||v(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"checkbox":a={type:"checkbox",name:u||v(s),disabled:!!r.attr("disabled"),selected:!!r.attr("checked")};break;case"radio":a={type:"radio",name:u||v(s),disabled:!!r.attr("disabled"),radio:!!r.attr("name"),value:r.val(),selected:!!r.attr("checked")};break;default:a=t}break;case"select":a={type:"select",name:u||v(s),disabled:!!r.attr("disabled"),selected:r.val(),options:{}},r.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:u||v(s),disabled:!!r.attr("disabled"),value:r.val()};break;case"label":break;default:a={type:"html",html:r.clone(!0)}}a&&(i++,n["key"+i]=a)}),i}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement;var n=null,r=!1,i=e(window),s=0,o={},u={},a={},f={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(t,n,r){var s=this,o;if(!n&&!r){t.determinePosition.call(this,t.$menu);return}if(n==="maintain"&&r==="maintain")o=t.$menu.position();else{var u=t.$trigger.parents().andSelf().filter(function(){return e(this).css("position")=="fixed"}).length;u&&(r-=i.scrollTop(),n-=i.scrollLeft()),o={top:r,left:n}}var a=i.scrollTop()+i.height(),f=i.scrollLeft()+i.width(),l=t.$menu.height(),c=t.$menu.width();o.top+l>a&&(o.top-=l),o.left+c>f&&(o.left-=c),t.$menu.css(o)},positionSubmenu:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top",at:"right top",of:this,collision:"fit"}).css("display","");else{var n={top:0,left:this.outerWidth()};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},l={timer:null,pageX:null,pageY:null},c=function(e){var t=0,n=e;for(;;){t=Math.max(t,parseInt(n.css("z-index"),10)||0),n=n.parent();if(!n||!n.length||"html body".indexOf(n.prop("nodeName").toLowerCase())>-1)break}return t},h={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var r=e(this);t.preventDefault(),t.stopImmediatePropagation();if(t.data.trigger!="right"&&t.originalEvent)return;if(!r.hasClass("context-menu-disabled")){n=r;if(t.data.build){var i=t.data.build(n,t);if(i===!1)return;t.data=e.extend(!0,{},f,t.data,i||{});if(!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),new Error("No Items sepcified");t.data.$trigger=n,p.create(t.data)}p.show.call(r,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var r=e(this);n&&n.length&&!n.is(r)&&n.data("contextMenu").$menu.trigger("contextmenu:hide"),t.button==2&&(n=r.data("contextMenuActive",!0))},mouseup:function(t){var r=e(this);r.data("contextMenuActive")&&n&&n.length&&n.is(r)&&!r.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),n=r,r.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),r.removeData("contextMenuActive")},mouseenter:function(t){var r=e(this),i=e(t.relatedTarget),s=e(document);if(i.is(".context-menu-list")||i.closest(".context-menu-list").length)return;if(n&&n.length)return;l.pageX=t.pageX,l.pageY=t.pageY,l.data=t.data,s.on("mousemove.contextMenuShow",h.mousemove),l.timer=setTimeout(function(){l.timer=null,s.off("mousemove.contextMenuShow"),n=r,r.trigger(e.Event("contextmenu",{data:l.data,pageX:l.pageX,pageY:l.pageY}))},t.data.delay)},mousemove:function(e){l.pageX=e.pageX,l.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(n.is(".context-menu-list")||n.closest(".context-menu-list").length)return;try{clearTimeout(l.timer)}catch(t){}l.timer=null},layerClick:function(t){var n=e(this),r=n.data("contextMenuRoot"),s=!1,u=t.button,a=t.pageX,f=t.pageY,l,c,h;t.preventDefault(),t.stopImmediatePropagation(),n.on("mouseup",function(){s=!0}),setTimeout(function(){var p,d;if(r.trigger=="left"&&u==0||r.trigger=="right"&&u==2)if(document.elementFromPoint){r.$layer.hide(),l=document.elementFromPoint(a-i.scrollLeft(),f-i.scrollTop()),r.$layer.show(),h=[];for(var v in o)h.push(v);l=e(l).closest(h.join(", "));if(l.length&&l.is(r.$trigger[0])){r.position.call(r.$trigger,r,a,f);return}}else{c=r.$trigger.offset(),p=e(window),c.top+=p.scrollTop();if(c.top<=t.pageY){c.left+=p.scrollLeft();if(c.left<=t.pageX){c.bottom=c.top+r.$trigger.outerHeight();if(c.bottom>=t.pageY){c.right=c.left+r.$trigger.outerWidth();if(c.right>=t.pageX){r.position.call(r.$trigger,r,a,f);return}}}}}d=function(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),r.$menu.trigger("contextmenu:hide"),l&&l.length&&setTimeout(function(){l.contextMenu({x:a,y:f})},50)},s?d():n.on("mouseup",d)},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t=n.data("contextMenu")||{},r=t.$menu.children(),i;switch(e.keyCode){case 9:case 38:h.keyStop(e,t);if(t.isInput){if(e.keyCode==9&&e.shiftKey){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("prevcommand");return}if(e.keyCode==38&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}}else if(e.keyCode!=9||e.shiftKey){t.$menu.trigger("prevcommand");return};case 40:h.keyStop(e,t);if(!t.isInput){t.$menu.trigger("nextcommand");return}if(e.keyCode==9){e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),t.$menu.trigger("nextcommand");return}if(e.keyCode==40&&t.$selected.find("input, textarea, select").prop("type")=="checkbox"){e.preventDefault();return}break;case 37:h.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var s=t.$selected.parent().parent();t.$selected.trigger("contextmenu:blur"),t.$selected=s;return}break;case 39:h.keyStop(e,t);if(t.isInput||!t.$selected||!t.$selected.length)break;var o=t.$selected.data("contextMenu")||{};if(o.$menu&&t.$selected.hasClass("context-menu-submenu")){t.$selected=null,o.$selected=null,o.$menu.trigger("nextcommand");return}break;case 35:case 36:if(t.$selected&&t.$selected.find("input, textarea, select").length)return;(t.$selected&&t.$selected.parent()||t.$menu).children(":not(.disabled, .not-selectable)")[e.keyCode==36?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault();return;case 13:h.keyStop(e,t);if(t.isInput){if(t.$selected&&!t.$selected.is("textarea, select")){e.preventDefault();return}break}t.$selected&&t.$selected.trigger("mouseup");return;case 32:case 33:case 34:h.keyStop(e,t);return;case 27:h.keyStop(e,t),t.$menu.trigger("contextmenu:hide");return;default:var u=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys[u]){t.accesskeys[u].$node.trigger(t.accesskeys[u].$menu?"contextmenu:focus":"mouseup");return}}e.stopPropagation(),t.$selected&&t.$selected.trigger(e)},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.prev().length?i.last():n.$selected.prev(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.prev().length?s=s.prev():s=i.last();if(s.is(o))return}n.$selected&&h.itemMouseleave.call(n.$selected.get(0),t),h.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{};if(n.$selected){var r=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=r}var i=n.$menu.children(),s=!n.$selected||!n.$selected.next().length?i.first():n.$selected.next(),o=s;while(s.hasClass("disabled")||s.hasClass("not-selectable")){s.next().length?s=s.next():s=i.first();if(s.is(o))return}n.$selected&&h.itemMouseleave.call(n.$selected.get(0),t),h.itemMouseenter.call(s.get(0),t);var u=s.find("input, textarea, select");u.length&&u.focus()},focusInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.$selected=i.$selected=n,s.isInput=i.isInput=!0},blurInput:function(t){var n=e(this).closest(".context-menu-item"),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.isInput=i.isInput=!1},menuMouseenter:function(t){var n=e(this).data().contextMenuRoot;n.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(i.$menu?i:s).$menu.children(".hover").trigger("contextmenu:blur");if(n.hasClass("disabled")||n.hasClass("not-selectable")){i.$selected=null;return}n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s!==i&&s.$layer&&s.$layer.is(t.relatedTarget)){s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),s.$selected=i.$selected=i.$node;return}n.trigger("contextmenu:blur")},itemClick:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot,o=r.contextMenuKey,u;if(!i.items[o]||n.hasClass("disabled")||n.hasClass("context-menu-submenu"))return;t.preventDefault(),t.stopImmediatePropagation();if(e.isFunction(s.callbacks[o]))u=s.callbacks[o];else{if(!e.isFunction(s.callback))return;u=s.callback}u.call(s.$trigger,o,s)!==!1?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&p.update.call(s.$trigger,s)},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var r=e(this).data("contextMenuRoot");p.hide.call(r.$trigger,r,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.addClass("hover").siblings(".hover").trigger("contextmenu:blur"),i.$selected=s.$selected=n,i.$node&&s.positionSubmenu.call(i.$node,i.$menu)},blurItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.removeClass("hover"),i.$selected=null}},p={show:function(t,r,i){var s=e(this),o,u={};e("#context-menu-layer").trigger("mousedown"),t.$trigger=s;if(t.events.show.call(s,t)===!1){n=null;return}p.update.call(s,t),t.position.call(s,t,r,i),t.zIndex&&(u.zIndex=c(s)+t.zIndex),p.layer.call(t.$menu,t,u.zIndex),t.$menu.find("ul").css("zIndex",u.zIndex+1),t.$menu.css(u)[t.animation.show](t.animation.duration),s.data("contextMenu",t),e(document).off("keydown.contextMenu").on("keydown.contextMenu",h.key);if(t.autoHide){var a=s.position();a.right=a.left+s.outerWidth(),a.bottom=a.top+this.outerHeight(),e(document).on("mousemove.contextMenuAutoHide",function(e){t.$layer&&!t.hovering&&(!(e.pageX>=a.left&&e.pageX<=a.right)||!(e.pageY>=a.top&&e.pageY<=a.bottom))&&t.$menu.trigger("contextmenu:hide")})}},hide:function(r,i){var s=e(this);r||(r=s.data("contextMenu")||{});if(!i&&r.events&&r.events.hide.call(s,r)===!1)return;if(r.$layer){setTimeout(function(e){return function(){e.remove()}}(r.$layer),10);try{delete r.$layer}catch(o){r.$layer=null}}n=null,r.$menu.find(".hover").trigger("contextmenu:blur"),r.$selected=null,e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),r.$menu&&r.$menu[r.animation.hide](r.animation.duration,function(){r.build&&(r.$menu.remove(),e.each(r,function(e,n){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:r[e]=t;try{delete r[e]}catch(i){}return!0}}))})},create:function(n,r){r===t&&(r=n),n.$menu=e('<ul class="context-menu-list '+(n.className||"")+'"></ul>').data({contextMenu:n,contextMenuRoot:r}),e.each(["callbacks","commands","inputs"],function(e,t){n[t]={},r[t]||(r[t]={})}),r.accesskeys||(r.accesskeys={}),e.each(n.items,function(t,i){var s=e('<li class="context-menu-item '+(i.className||"")+'"></li>'),o=null,u=null;i.$node=s.data({contextMenu:n,contextMenuRoot:r,contextMenuKey:t});if(i.accesskey){var f=d(i.accesskey);for(var l=0,c;c=f[l];l++)if(!r.accesskeys[c]){r.accesskeys[c]=i,i._name=i.name.replace(new RegExp("("+c+")","i"),'<span class="context-menu-accesskey">$1</span>');break}}if(typeof i=="string")s.addClass("context-menu-separator not-selectable");else if(i.type&&a[i.type])a[i.type].call(s,i,n,r),e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)});else{i.type=="html"?s.addClass("context-menu-html not-selectable"):i.type?(o=e("<label></label>").appendTo(s),e("<span></span>").html(i._name||i.name).appendTo(o),s.addClass("context-menu-input"),n.hasTypes=!0,e.each([n,r],function(e,n){n.commands[t]=i,n.inputs[t]=i})):i.items&&(i.type="sub");switch(i.type){case"text":u=e('<input type="text" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").appendTo(o);break;case"textarea":u=e('<textarea name="context-menu-input-'+t+'"></textarea>').val(i.value||"").appendTo(o),i.height&&u.height(i.height);break;case"checkbox":u=e('<input type="checkbox" value="1" name="context-menu-input-'+t+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"radio":u=e('<input type="radio" value="1" name="context-menu-input-'+i.radio+'" value="">').val(i.value||"").prop("checked",!!i.selected).prependTo(o);break;case"select":u=e('<select name="context-menu-input-'+t+'">').appendTo(o),i.options&&(e.each(i.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(u)}),u.val(i.selected));break;case"sub":e("<span></span>").html(i._name||i.name).appendTo(s),i.appendTo=i.$node,p.create(i,r),s.data("contextMenu",i).addClass("context-menu-submenu"),i.callback=null;break;case"html":e(i.html).appendTo(s);break;default:e.each([n,r],function(n,r){r.commands[t]=i,e.isFunction(i.callback)&&(r.callbacks[t]=i.callback)}),e("<span></span>").html(i._name||i.name||"").appendTo(s)}i.type&&i.type!="sub"&&i.type!="html"&&(u.on("focus",h.focusInput).on("blur",h.blurInput),i.events&&u.on(i.events,n)),i.icon&&s.addClass("icon icon-"+i.icon)}i.$input=u,i.$label=o,s.appendTo(n.$menu),!n.hasTypes&&e.support.eventSelectstart&&s.on("selectstart.disableTextSelect",h.abortevent)}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},update:function(n,r){var i=this;r===t&&(r=n,n.$menu.find("ul").andSelf().css({position:"static",display:"block"}).each(function(){var t=e(this);t.width(t.css("position","absolute").width()).css("position","static")}).css({position:"",display:""})),n.$menu.children().each(function(){var t=e(this),s=t.data("contextMenuKey"),o=n.items[s],u=e.isFunction(o.disabled)&&o.disabled.call(i,s,r)||o.disabled===!0;t[u?"addClass":"removeClass"]("disabled");if(o.type){t.find("input, select, textarea").prop("disabled",u);switch(o.type){case"text":case"textarea":o.$input.val(o.value||"");break;case"checkbox":case"radio":o.$input.val(o.value||"").prop("checked",!!o.selected);break;case"select":o.$input.val(o.selected||"")}}o.$menu&&p.update.call(i,o,r)})},layer:function(t,n){var r=t.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+n+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:i.height(),width:i.width(),display:"block"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",h.abortevent).on("mousedown",h.layerClick);return e.support.fixedPosition||r.css({position:"absolute",height:e(document).height()}),r}};e.fn.contextMenu=function(n){if(n===t)this.first().trigger("contextmenu");else if(n.x&&n.y)this.first().trigger(e.Event("contextmenu",{pageX:n.x,pageY:n.y}));else if(n==="hide"){var r=this.data("contextMenu").$menu;r&&r.trigger("contextmenu:hide")}else n?this.removeClass("context-menu-disabled"):n||this.addClass("context-menu-disabled");return this},e.contextMenu=function(n,i){typeof n!="string"&&(i=n,n="create"),typeof i=="string"?i={selector:i}:i===t&&(i={});var a=e.extend(!0,{},f,i||{}),l=e(document);switch(n){case"create":if(!a.selector)throw new Error("No selector specified");if(a.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+a.selector+'" as it contains a reserved className');if(!a.build&&(!a.items||e.isEmptyObject(a.items)))throw new Error("No Items sepcified");s++,a.ns=".contextMenu"+s,o[a.selector]=a.ns,u[a.ns]=a,a.trigger||(a.trigger="right"),r||(l.on({"contextmenu:hide.contextMenu":h.hideMenu,"prevcommand.contextMenu":h.prevItem,"nextcommand.contextMenu":h.nextItem,"contextmenu.contextMenu":h.abortevent,"mouseenter.contextMenu":h.menuMouseenter,"mouseleave.contextMenu":h.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",h.inputClick).on({"mouseup.contextMenu":h.itemClick,"contextmenu:focus.contextMenu":h.focusItem,"contextmenu:blur.contextMenu":h.blurItem,"contextmenu.contextMenu":h.abortevent,"mouseenter.contextMenu":h.itemMouseenter,"mouseleave.contextMenu":h.itemMouseleave},".context-menu-item"),r=!0),l.on("contextmenu"+a.ns,a.selector,a,h.contextmenu);switch(a.trigger){case"hover":l.on("mouseenter"+a.ns,a.selector,a,h.mouseenter).on("mouseleave"+a.ns,a.selector,a,h.mouseleave);break;case"left":l.on("click"+a.ns,a.selector,a,h.click)}a.build||p.create(a);break;case"destroy":if(!a.selector)l.off(".contextMenu .contextMenuAutoHide"),e.each(o,function(e,t){l.off(t)}),o={},u={},s=0,r=!1,e("#context-menu-layer, .context-menu-list").remove();else if(o[a.selector]){var c=e(".context-menu-list").filter(":visible");c.length&&c.data().contextMenuRoot.$trigger.is(a.selector)&&c.trigger("contextmenu:hide",{force:!0});try{u[o[a.selector]].$menu&&u[o[a.selector]].$menu.remove(),delete u[o[a.selector]]}catch(d){u[o[a.selector]]=null}l.off(o[a.selector])}break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||typeof i=="boolean"&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+n+'"')}return this},e.contextMenu.setInputValues=function(n,r){r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=r[e]||"";break;case"checkbox":t.selected=r[e]?!0:!1;break;case"radio":t.selected=(r[t.radio]||"")==t.value?!0:!1;break;case"select":t.selected=r[e]||""}})},e.contextMenu.getInputValues=function(n,r){return r===t&&(r={}),e.each(n.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":r[e]=t.$input.val();break;case"checkbox":r[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(r[t.radio]=t.value)}}),r},e.contextMenu.fromMenu=function(t){var n=e(t),r={};return m(r,n.children()),r},e.contextMenu.defaults=f,e.contextMenu.types=a}(jQuery);